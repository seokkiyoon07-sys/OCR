<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SNar OCR 채점기 — Wireframe</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* 간단한 유틸 */
    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .modal {
      display: none;
    }

    .modal.open {
      display: grid;
    }
  </style>
</head>

<body class="min-h-screen bg-neutral-50">
  <!-- Header -->
  <header class="sticky top-0 z-30 border-b bg-white/80 backdrop-blur">
    <div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-3">
      <div class="flex items-center gap-2">
        <div class="h-8 w-8 rounded-xl bg-black"></div>
        <div class="text-lg font-semibold">SNar OCR 채점기</div>
        <span class="hidden rounded-full border px-2 py-0.5 text-xs text-neutral-600 md:inline-block">Beta</span>
      </div>
      <div class="flex items-center gap-2">
        <button class="px-3 py-2 text-sm rounded-lg hover:bg-neutral-100" data-goto="pricing">요금제</button>
        <button class="px-3 py-2 text-sm rounded-lg hover:bg-neutral-100" data-goto="faq">문의</button>
        <button id="openAuth" class="px-3 py-2 text-sm rounded-xl bg-black text-white">로그인</button>
      </div>
    </div>
  </header>

  <!-- Body -->
  <div class="mx-auto grid max-w-7xl grid-cols-1 gap-6 px-4 py-6 md:grid-cols-[260px_1fr]">
    <!-- Sidebar -->
    <aside class="hidden md:block">
      <nav id="sidebar" class="space-y-1">
        <!-- 버튼들은 JS에서 생성 -->
      </nav>
    </aside>

    <!-- Main -->
    <main class="space-y-6">
      <!-- Landing -->
      <section class="page active" id="page-landing">
        <div class="space-y-6">
          <div class="grid gap-6 md:grid-cols-2">
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h2 class="text-lg font-semibold">수능 특화 OCR 채점기</h2>
              </div>
              <div class="p-6 space-y-3 text-sm text-neutral-600">
                <p>문제지를 찍거나 PDF를 업로드하면 즉시 인식하고 자동 채점합니다. 틀린 문제는 하이라이트로 표시되며, 유형별 오답 통계를 제공합니다.</p>
                <div class="grid grid-cols-3 gap-3">
                  <div class="rounded-xl bg-neutral-100 p-3">
                    <div class="text-2xl font-semibold">97.8%</div>
                    <div class="text-xs text-neutral-500">OCR 정확도(내부테스트)</div>
                  </div>
                  <div class="rounded-xl bg-neutral-100 p-3">
                    <div class="text-2xl font-semibold">&lt;1s</div>
                    <div class="text-xs text-neutral-500">평균 문항 인식 시간</div>
                  </div>
                  <div class="rounded-xl bg-neutral-100 p-3">
                    <div class="text-2xl font-semibold">46+</div>
                    <div class="text-xs text-neutral-500">문항 세트 동시 처리</div>
                  </div>
                </div>
                <div class="flex gap-2 pt-1">
                  <button class="px-4 py-2 rounded-xl bg-black text-white" data-goto="upload">지금 체험하기</button>
                  <button class="px-4 py-2 rounded-xl border">데모 보기</button>
                </div>
              </div>
            </div>

            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h2 class="text-lg font-semibold">주요 기능</h2>
              </div>
              <div class="p-6 text-sm text-neutral-700">
                <ul class="list-disc list-inside space-y-1">
                  <li>스냅샷/스캔 이미지/PDF 업로드</li>
                  <li>자동 정답 매칭 & 점수 산출</li>
                  <li>오답노트 자동 생성</li>
                  <li>유형별/단원별 취약점 분석</li>
                  <li>학원 관리자용 대시보드</li>
                  <li>CSV/PDF 내보내기</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="rounded-2xl border bg-white">
            <div class="p-6 border-b">
              <h2 class="text-lg font-semibold">데이터 보호 & 보안</h2>
            </div>
            <div class="p-6 grid gap-4 md:grid-cols-3">
              <div class="rounded-xl border p-4">
                <div class="text-sm font-semibold">최소 수집 원칙</div>
                <p class="text-xs text-neutral-600">채점에 필요한 데이터만 수집하여 분석에 활용합니다.</p>
              </div>
              <div class="rounded-xl border p-4">
                <div class="text-sm font-semibold">암호화 저장</div>
                <p class="text-xs text-neutral-600">식별 정보와 점수 데이터는 별도 저장 및 암호화합니다.</p>
              </div>
              <div class="rounded-xl border p-4">
                <div class="text-sm font-semibold">동의 기반 분석</div>
                <p class="text-xs text-neutral-600">개인정보 및 통계 활용은 이용자 동의를 전제로 합니다.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Upload -->
      <section class="page" id="page-upload">
        <div class="space-y-6">
          <div class="mb-2">
            <h2 class="text-xl font-semibold">채점 업로드</h2>
            <p class="text-sm text-neutral-600">이미지(JPG/PNG) 또는 PDF를 업로드하세요</p>
          </div>

          <div class="grid gap-6 md:grid-cols-3">
            <div class="md:col-span-2 rounded-2xl border bg-white">
              <div class="p-6 space-y-4">
                <div class="rounded-2xl border border-dashed p-8 text-center">
                  <i data-lucide="upload" class="mx-auto" style="width:40px;height:40px"></i>
                  <div class="mt-2 text-sm text-neutral-600">파일을 여기로 끌어다 놓거나 클릭해서 선택</div>
                  <div class="mt-3 inline-flex gap-2">
                    <button class="px-3 py-2 rounded-xl border text-sm">이미지 선택</button>
                    <button class="px-3 py-2 rounded-xl border text-sm">PDF 선택</button>
                  </div>
                </div>

                <div class="grid gap-3 md:grid-cols-2">
                  <div class="space-y-1">
                    <label class="text-sm font-medium">시험 선택</label>
                    <button id="openExamModal" class="w-full rounded-xl border px-3 py-2 text-sm text-left flex items-center justify-between">
                      <span id="selectedExam">시험을 선택하세요</span>
                      <i data-lucide="chevron-down" class="w-4 h-4"></i>
                    </button>
                  </div>
                  <div class="space-y-1">
                    <label class="text-sm font-medium">정답지</label>
                    <div class="flex gap-2">
                      <button id="openAnswerModal" class="px-3 py-2 rounded-xl border text-sm">정답 입력</button>
                      <button id="openSearchModal" class="px-3 py-2 rounded-xl border text-sm">기존 입력된 정답 찾기</button>
                    </div>
                  </div>
                  <div class="space-y-1">
                    <label class="text-sm font-medium">인식 옵션</label>
                    <div class="flex items-center gap-3 rounded-xl border p-3 text-sm">
                      <label class="inline-flex items-center gap-2"><input type="checkbox" /> 이미지 향상</label>
                      <label class="inline-flex items-center gap-2"><input type="checkbox" /> 필기체 보정</label>
                    </div>
                  </div>
                  <div class="space-y-1">
                    <label class="text-sm font-medium">메모 (선택)</label>
                    <input class="w-full rounded-xl border px-3 py-2 text-sm" placeholder="응시자 이름, 반, 비고 등" />
                  </div>
                </div>

                <div class="flex justify-end gap-2">
                  <button class="px-4 py-2 rounded-xl border">샘플 파일 사용</button>
                  <button class="px-4 py-2 rounded-xl bg-black text-white" data-goto="result">채점 시작</button>
                </div>
              </div>
            </div>

            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">가이드</h3>
              </div>
              <div class="p-6 space-y-3 text-sm text-neutral-600">
                <p>• 빛 반사가 적고, 테두리가 잘 보이게 촬영해 주세요.</p>
                <p>• PDF는 300dpi 이상 권장, 다중 페이지 지원.</p>
                <p>• 객관식/서술식 혼합 시 서술형은 별도 검토 단계가 열립니다.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Result -->
      <section class="page" id="page-result">
        <div class="space-y-6">
          <div class="mb-2">
            <h2 class="text-xl font-semibold">채점 결과</h2>
            <p class="text-sm text-neutral-600">총점과 문항별 정오표를 확인하세요</p>
          </div>

          <div class="grid gap-6 lg:grid-cols-4">
            <div class="lg:col-span-1 rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">요약</h3>
              </div>
              <div class="p-6 space-y-4 text-sm">
                <div class="grid grid-cols-2 gap-4">
                  <div class="rounded-xl bg-blue-50 p-4 border-2 border-blue-200">
                    <div class="text-3xl font-bold text-blue-600" id="resultTotalScore">-</div>
                    <div class="text-sm text-blue-700 font-medium">총점</div>
                  </div>
                  <div class="rounded-xl bg-red-50 p-4 border-2 border-red-200">
                    <div class="text-3xl font-bold text-red-600" id="resultWrongCount">-</div>
                    <div class="text-sm text-red-700 font-medium">오답</div>
                  </div>
                </div>
                <div class="rounded-xl border-2 border-gray-200 p-4 bg-gray-50">
                  <div class="text-sm text-gray-600 mb-2 font-medium">틀린 문항:</div>
                  <div class="text-base font-bold text-red-600" id="resultWrongQuestions">-</div>
                </div>
                <div class="rounded-xl border p-3 text-xs text-neutral-600" id="resultTypeSummary">
                  채점을 시작하면 결과가 표시됩니다
                </div>
                <div class="flex gap-3">
                  <button class="px-4 py-2 rounded-xl border-2 border-blue-600 text-blue-600 hover:bg-blue-50 font-medium">PDF 내보내기</button>
                  <button class="px-4 py-2 rounded-xl border-2 border-green-600 text-green-600 hover:bg-green-50 font-medium">CSV 내보내기</button>
                </div>
              </div>
            </div>

            <div class="lg:col-span-3 rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">문항별 결과</h3>
              </div>
              <div class="p-6">
                <div id="questionResults" class="w-full">
                  <!-- 문항별 결과가 여기에 동적으로 생성됩니다 -->
                </div>
                <div class="mt-4 rounded-2xl border p-4">
                  <div class="mb-2 text-sm font-medium">오답 하이라이트 (미리보기)</div>
                  <div class="grid h-40 place-items-center rounded-xl bg-neutral-100 text-xs text-neutral-500">스캔 이미지에서
                    오답 영역 박스 오버레이 (와이어프레임)</div>
                </div>
                <div class="mt-3 flex justify-end">
                  <button class="px-4 py-2 rounded-xl bg-black text-white" data-goto="analytics">유형 분석 보기</button>
                </div>
              </div>
            </div>
          </div>

          <div class="rounded-2xl border bg-white">
            <div class="p-6 border-b">
              <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold">오답노트</h3>
                <div class="flex items-center gap-2">
                  <label class="text-sm text-neutral-600">과목:</label>
                  <select id="wrongNoteSubjectFilter" class="px-3 py-1 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="filterWrongNotes()">
                    <option value="all">전체</option>
                    <option value="수학">수학</option>
                    <option value="국어">국어</option>
                    <option value="영어">영어</option>
                    <option value="과학탐구">과학탐구</option>
                    <option value="사회탐구">사회탐구</option>
                    <option value="한국사">한국사</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="p-6">
              <div id="wrongNotesList" class="space-y-4">
                <!-- 동적으로 생성되는 오답노트 목록 -->
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- My Page (Student) -->
      <section class="page" id="page-mypage">
        <div class="space-y-6">
          <div class="mb-2">
            <h2 class="text-xl font-semibold">마이페이지</h2>
            <p class="text-sm text-neutral-600">채점 기록과 프로필을 관리합니다</p>
          </div>
          <div class="grid gap-6 md:grid-cols-3">
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">프로필</h3>
              </div>
              <div class="p-6 space-y-3 text-sm">
                <input class="w-full rounded-xl border px-3 py-2" placeholder="이름" value="홍길동" />
                <div class="grid grid-cols-2 gap-2">
                  <input class="rounded-xl border px-3 py-2" placeholder="학교" value="SN고" />
                  <input class="rounded-xl border px-3 py-2" placeholder="학년" value="고2" />
                </div>
                <button class="px-3 py-2 rounded-xl bg-black text-white text-sm">저장</button>
              </div>
            </div>

            <div class="md:col-span-2 rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <h3 class="text-lg font-semibold">최근 채점 기록</h3>
                    <span id="totalCount" class="px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-full font-medium">총 6건</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <label class="text-sm text-neutral-600">과목 필터:</label>
                    <select id="subjectFilter" class="px-3 py-1 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="filterRecords()">
                      <option value="all">전체</option>
                      <option value="국어">국어</option>
                      <option value="수학">수학</option>
                      <option value="영어">영어</option>
                      <option value="탐구">탐구</option>
                      <option value="기타">기타</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="p-6">
                <table class="w-full text-left text-sm">
                  <thead>
                    <tr class="text-neutral-500 border-b">
                      <th class="py-3 px-2">채점날짜</th>
                      <th class="py-3 px-2">평가기관</th>
                      <th class="py-3 px-2">시행월</th>
                      <th class="py-3 px-2">과목</th>
                      <th class="py-3 px-2">점수</th>
                      <th class="py-3 px-2">오답</th>
                      <th class="py-3 px-2">채점결과</th>
                    </tr>
                  </thead>
                  <tbody id="recordsTableBody">
                    <tr class="border-t hover:bg-gray-50" data-subject="수학">
                      <td class="py-3 px-2">2025-09-01</td>
                      <td class="py-3 px-2">한국교육과정평가원</td>
                      <td class="py-3 px-2">9월</td>
                      <td class="py-3 px-2 text-center">
                        <div class="flex flex-col gap-1 items-center">
                          <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">수학</span>
                          <span class="text-xs text-gray-600">미적분</span>
                        </div>
                      </td>
                      <td class="py-3 px-2 font-semibold text-green-600">92점</td>
                      <td class="py-3 px-2 text-red-600">6개</td>
                      <td class="py-3 px-2">
                        <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewResult('수학', '미적분', '2025-09-01', '9평 수학', 92, 6)">보기</button>
                      </td>
                    </tr>
                    <tr class="border-t hover:bg-gray-50" data-subject="국어">
                      <td class="py-3 px-2">2025-09-02</td>
                      <td class="py-3 px-2">한국교육과정평가원</td>
                      <td class="py-3 px-2">9월</td>
                      <td class="py-3 px-2 text-center">
                        <div class="flex flex-col gap-1 items-center">
                          <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">국어</span>
                          <span class="text-xs text-gray-600">언어와매체</span>
                        </div>
                      </td>
                      <td class="py-3 px-2 font-semibold text-green-600">88점</td>
                      <td class="py-3 px-2 text-red-600">8개</td>
                      <td class="py-3 px-2">
                        <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewResult('국어', '언어와매체', '2025-09-02', '9평 국어', 88, 8)">보기</button>
                      </td>
                    </tr>
                    <tr class="border-t hover:bg-gray-50" data-subject="영어">
                      <td class="py-3 px-2">2025-09-03</td>
                      <td class="py-3 px-2">한국교육과정평가원</td>
                      <td class="py-3 px-2">6월</td>
                      <td class="py-3 px-2 text-center">
                        <div class="flex flex-col gap-1 items-center">
                          <span class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800">영어</span>
                          <span class="text-xs text-gray-600">영어</span>
                        </div>
                      </td>
                      <td class="py-3 px-2 font-semibold text-green-600">95점</td>
                      <td class="py-3 px-2 text-red-600">5개</td>
                      <td class="py-3 px-2">
                        <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewResult('영어', '영어', '2025-09-03', '6모 영어', 95, 5)">보기</button>
                      </td>
                    </tr>
                    <tr class="border-t hover:bg-gray-50" data-subject="탐구">
                      <td class="py-3 px-2">2025-08-28</td>
                      <td class="py-3 px-2">한국교육과정평가원</td>
                      <td class="py-3 px-2">6월</td>
                      <td class="py-3 px-2 text-center">
                        <div class="flex flex-col gap-1 items-center">
                          <span class="px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800">과학탐구</span>
                          <span class="text-xs text-gray-600">물리1</span>
                        </div>
                      </td>
                      <td class="py-3 px-2 font-semibold text-green-600">78점</td>
                      <td class="py-3 px-2 text-red-600">12개</td>
                      <td class="py-3 px-2">
                        <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewResult('과학탐구', '물리1', '2025-08-28', '6모 과학탐구', 78, 12)">보기</button>
                      </td>
                    </tr>
                    <tr class="border-t hover:bg-gray-50" data-subject="탐구">
                      <td class="py-3 px-2">2025-08-25</td>
                      <td class="py-3 px-2">한국교육과정평가원</td>
                      <td class="py-3 px-2">6월</td>
                      <td class="py-3 px-2 text-center">
                        <div class="flex flex-col gap-1 items-center">
                          <span class="px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800">사회탐구</span>
                          <span class="text-xs text-gray-600">사회문화</span>
                        </div>
                      </td>
                      <td class="py-3 px-2 font-semibold text-green-600">82점</td>
                      <td class="py-3 px-2 text-red-600">9개</td>
                      <td class="py-3 px-2">
                        <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewResult('사회탐구', '사회문화', '2025-08-25', '6모 사회탐구', 82, 9)">보기</button>
                      </td>
                    </tr>
                    <tr class="border-t hover:bg-gray-50" data-subject="기타">
                      <td class="py-3 px-2">2025-08-20</td>
                      <td class="py-3 px-2">한국교육과정평가원</td>
                      <td class="py-3 px-2">6월</td>
                      <td class="py-3 px-2 text-center">
                        <div class="flex flex-col gap-1 items-center">
                          <span class="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800">한국사</span>
                          <span class="text-xs text-gray-600">한국사</span>
                        </div>
                      </td>
                      <td class="py-3 px-2 font-semibold text-green-600">90점</td>
                      <td class="py-3 px-2 text-red-600">2개</td>
                      <td class="py-3 px-2">
                        <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewResult('한국사', '한국사', '2025-08-20', '6모 한국사', 90, 2)">보기</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- My Page (Teacher) -->
      <section class="page" id="page-teacher-mypage">
        <div class="space-y-6">
          <div class="mb-2">
            <h2 class="text-xl font-semibold">교사 마이페이지</h2>
            <p class="text-sm text-neutral-600">학급 관리 및 채점 현황을 확인합니다</p>
          </div>
          
          <div class="grid gap-6 md:grid-cols-3">
            <!-- 교사 프로필 -->
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">교사 정보</h3>
              </div>
              <div class="p-6 space-y-3 text-sm">
                <input class="w-full rounded-xl border px-3 py-2" placeholder="이름" value="김선생" />
                <div class="grid grid-cols-2 gap-2">
                  <input class="rounded-xl border px-3 py-2" placeholder="학교" value="SN고등학교" />
                  <input class="rounded-xl border px-3 py-2" placeholder="담당과목" value="수학" />
                </div>
                <input class="w-full rounded-xl border px-3 py-2" placeholder="담당학년" value="2학년" />
                <button class="px-3 py-2 rounded-xl bg-black text-white text-sm">저장</button>
              </div>
            </div>

            <!-- 학급 현황 -->
            <div class="md:col-span-2 rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">학급 현황</h3>
              </div>
              <div class="p-6">
                <div class="grid grid-cols-2 gap-6 mb-6">
                  <div class="text-center">
                    <div class="text-3xl font-bold text-blue-600">32명</div>
                    <div class="text-sm text-gray-600">총 학생 수</div>
                  </div>
                  <div class="text-center">
                    <div class="text-3xl font-bold text-green-600">28명</div>
                    <div class="text-sm text-gray-600">채점 완료</div>
                  </div>
                </div>
                
                <div class="space-y-3">
                  <h4 class="font-semibold text-gray-800">최근 채점 현황</h4>
                  <div class="space-y-2">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                      <div>
                        <div class="font-medium">9월 모의고사 수학</div>
                        <div class="text-sm text-gray-600">2025-09-15</div>
                      </div>
                      <div class="text-right">
                        <div class="text-sm font-medium text-green-600">28/32명 완료</div>
                        <div class="text-xs text-gray-500">87.5%</div>
                      </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                      <div>
                        <div class="font-medium">6월 모의고사 수학</div>
                        <div class="text-sm text-gray-600">2025-06-15</div>
                      </div>
                      <div class="text-right">
                        <div class="text-sm font-medium text-green-600">32/32명 완료</div>
                        <div class="text-xs text-gray-500">100%</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 전체 채점 기록 -->
          <div class="rounded-2xl border bg-white">
            <div class="p-6 border-b">
              <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold">전체 채점 기록</h3>
                <div class="flex items-center gap-4">
                  <div class="flex items-center gap-2">
                    <label class="text-sm text-neutral-600">과목:</label>
                    <select id="teacherSubjectFilter" class="px-3 py-1 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="filterTeacherRecords()">
                      <option value="all">전체</option>
                      <option value="수학">수학</option>
                      <option value="국어">국어</option>
                      <option value="영어">영어</option>
                      <option value="과학탐구">과학탐구</option>
                      <option value="사회탐구">사회탐구</option>
                      <option value="한국사">한국사</option>
                      <option value="기타">기타</option>
                    </select>
                  </div>
                  
                  <div class="flex items-center gap-2">
                    <label class="text-sm text-neutral-600">시행월:</label>
                    <select id="teacherMonthFilter" class="px-3 py-1 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="filterTeacherRecords()">
                      <option value="all">전체</option>
                      <option value="9월">9월</option>
                      <option value="6월">6월</option>
                      <option value="3월">3월</option>
                      <option value="11월">11월</option>
                      <option value="기타">기타</option>
                    </select>
                  </div>
                  
                  <div class="flex items-center gap-2">
                    <label class="text-sm text-neutral-600">평가기관:</label>
                    <select id="teacherAgencyFilter" class="px-3 py-1 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="filterTeacherRecords()">
                      <option value="all">전체</option>
                      <option value="한국교육과정평가원">한국교육과정평가원</option>
                      <option value="서울특별시교육청">서울특별시교육청</option>
                      <option value="경기도교육청">경기도교육청</option>
                      <option value="인천광역시교육청">인천광역시교육청</option>
                      <option value="기타">기타</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <div class="p-6">
              <table class="w-full text-left text-sm">
                <thead>
                  <tr class="text-neutral-500 border-b">
                    <th class="py-3 px-2">채점날짜</th>
                    <th class="py-3 px-2">평가기관</th>
                    <th class="py-3 px-2">시행월</th>
                    <th class="py-3 px-2">시험명</th>
                    <th class="py-3 px-2">과목</th>
                    <th class="py-3 px-2">채점인원</th>
                    <th class="py-3 px-2">평균점수</th>
                    <th class="py-3 px-2">관리</th>
                  </tr>
                </thead>
                <tbody id="teacherRecordsTableBody">
                  <tr class="border-t hover:bg-gray-50">
                    <td class="py-3 px-2">2025-09-15</td>
                    <td class="py-3 px-2">한국교육과정평가원</td>
                    <td class="py-3 px-2">9월</td>
                    <td class="py-3 px-2">9월 모의고사</td>
                    <td class="py-3 px-2 text-center">
                      <div class="flex flex-col gap-1 items-center">
                        <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">수학</span>
                        <span class="text-xs text-gray-600">미적분</span>
                      </div>
                    </td>
                    <td class="py-3 px-2 font-semibold text-blue-600">28명</td>
                    <td class="py-3 px-2 font-semibold text-green-600">78.5점</td>
                    <td class="py-3 px-2">
                      <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewStudentList('수학', '미적분', '2025-09-15', '9월 모의고사')">보기</button>
                    </td>
                  </tr>
                  <tr class="border-t hover:bg-gray-50">
                    <td class="py-3 px-2">2025-09-15</td>
                    <td class="py-3 px-2">한국교육과정평가원</td>
                    <td class="py-3 px-2">9월</td>
                    <td class="py-3 px-2">9월 모의고사</td>
                    <td class="py-3 px-2 text-center">
                      <div class="flex flex-col gap-1 items-center">
                        <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">국어</span>
                        <span class="text-xs text-gray-600">언어와매체</span>
                      </div>
                    </td>
                    <td class="py-3 px-2 font-semibold text-blue-600">32명</td>
                    <td class="py-3 px-2 font-semibold text-green-600">82.3점</td>
                    <td class="py-3 px-2">
                      <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewStudentList('국어', '언어와매체', '2025-09-15', '9월 모의고사')">보기</button>
                    </td>
                  </tr>
                  <tr class="border-t hover:bg-gray-50">
                    <td class="py-3 px-2">2025-09-15</td>
                    <td class="py-3 px-2">한국교육과정평가원</td>
                    <td class="py-3 px-2">9월</td>
                    <td class="py-3 px-2">9월 모의고사</td>
                    <td class="py-3 px-2 text-center">
                      <div class="flex flex-col gap-1 items-center">
                        <span class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800">영어</span>
                        <span class="text-xs text-gray-600">영어</span>
                      </div>
                    </td>
                    <td class="py-3 px-2 font-semibold text-blue-600">30명</td>
                    <td class="py-3 px-2 font-semibold text-green-600">85.7점</td>
                    <td class="py-3 px-2">
                      <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewStudentList('영어', '영어', '2025-09-15', '9월 모의고사')">보기</button>
                    </td>
                  </tr>
                  <tr class="border-t hover:bg-gray-50">
                    <td class="py-3 px-2">2025-06-15</td>
                    <td class="py-3 px-2">한국교육과정평가원</td>
                    <td class="py-3 px-2">6월</td>
                    <td class="py-3 px-2">6월 모의고사</td>
                    <td class="py-3 px-2 text-center">
                      <div class="flex flex-col gap-1 items-center">
                        <span class="px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800">과학탐구</span>
                        <span class="text-xs text-gray-600">물리1</span>
                      </div>
                    </td>
                    <td class="py-3 px-2 font-semibold text-blue-600">25명</td>
                    <td class="py-3 px-2 font-semibold text-green-600">76.2점</td>
                    <td class="py-3 px-2">
                      <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewStudentList('과학탐구', '물리1', '2025-06-15', '6월 모의고사')">보기</button>
                    </td>
                  </tr>
                  <tr class="border-t hover:bg-gray-50">
                    <td class="py-3 px-2">2025-03-15</td>
                    <td class="py-3 px-2">서울특별시교육청</td>
                    <td class="py-3 px-2">3월</td>
                    <td class="py-3 px-2">3월 학력평가</td>
                    <td class="py-3 px-2 text-center">
                      <div class="flex flex-col gap-1 items-center">
                        <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">국어</span>
                        <span class="text-xs text-gray-600">화법과작문</span>
                      </div>
                    </td>
                    <td class="py-3 px-2 font-semibold text-blue-600">30명</td>
                    <td class="py-3 px-2 font-semibold text-green-600">81.5점</td>
                    <td class="py-3 px-2">
                      <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewStudentList('국어', '화법과작문', '2025-03-15', '3월 학력평가')">보기</button>
                    </td>
                  </tr>
                  <tr class="border-t hover:bg-gray-50">
                    <td class="py-3 px-2">2025-11-15</td>
                    <td class="py-3 px-2">경기도교육청</td>
                    <td class="py-3 px-2">11월</td>
                    <td class="py-3 px-2">11월 모의고사</td>
                    <td class="py-3 px-2 text-center">
                      <div class="flex flex-col gap-1 items-center">
                        <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">수학</span>
                        <span class="text-xs text-gray-600">확률과통계</span>
                      </div>
                    </td>
                    <td class="py-3 px-2 font-semibold text-blue-600">28명</td>
                    <td class="py-3 px-2 font-semibold text-green-600">79.3점</td>
                    <td class="py-3 px-2">
                      <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewStudentList('수학', '확률과통계', '2025-11-15', '11월 모의고사')">보기</button>
                    </td>
                  </tr>
                  <tr class="border-t hover:bg-gray-50">
                    <td class="py-3 px-2">2025-09-20</td>
                    <td class="py-3 px-2">인천광역시교육청</td>
                    <td class="py-3 px-2">9월</td>
                    <td class="py-3 px-2">9월 학력평가</td>
                    <td class="py-3 px-2 text-center">
                      <div class="flex flex-col gap-1 items-center">
                        <span class="px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800">사회탐구</span>
                        <span class="text-xs text-gray-600">한국지리</span>
                      </div>
                    </td>
                    <td class="py-3 px-2 font-semibold text-blue-600">26명</td>
                    <td class="py-3 px-2 font-semibold text-green-600">77.8점</td>
                    <td class="py-3 px-2">
                      <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" onclick="viewStudentList('사회탐구', '한국지리', '2025-09-20', '9월 학력평가')">보기</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Analytics (Student) -->
      <section class="page" id="page-analytics">
        <div class="space-y-6">
          <div class="mb-2">
            <h2 class="text-xl font-semibold">유형 분석</h2>
            <p class="text-sm text-neutral-600">과목/단원/유형별 취약점을 시각화합니다</p>
          </div>
          <!-- 반별 채점인원 및 평균점수 그래프 -->
          <div class="grid gap-6 md:grid-cols-2">
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">반별 채점인원</h3>
                <p class="text-sm text-gray-600">각 반의 채점 참여 학생 수</p>
              </div>
              <div class="p-6">
                <canvas id="classParticipationChart" width="400" height="200"></canvas>
              </div>
            </div>
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">반별 평균점수</h3>
                <p class="text-sm text-gray-600">각 반의 평균 채점 점수</p>
              </div>
              <div class="p-6">
                <canvas id="classAverageChart" width="400" height="200"></canvas>
              </div>
            </div>
          </div>

          <div class="grid gap-6 md:grid-cols-3">
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <div class="flex items-center justify-between">
                  <h3 class="text-lg font-semibold">점수 추이</h3>
                  <div class="flex items-center gap-2">
                    <label class="text-sm text-neutral-600">과목:</label>
                    <select id="scoreTrendSubjectFilter" class="px-3 py-1 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="updateScoreTrendChart()">
                      <option value="수학">수학</option>
                      <option value="국어">국어</option>
                      <option value="영어">영어</option>
                      <option value="과학탐구">과학탐구</option>
                      <option value="사회탐구">사회탐구</option>
                      <option value="한국사">한국사</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="p-6">
                <canvas id="scoreTrendChart" width="400" height="200"></canvas>
              </div>
            </div>
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <div class="flex items-center justify-between">
                  <h3 class="text-lg font-semibold">유형별 오답률</h3>
                  <div class="flex items-center gap-2">
                    <label class="text-sm text-neutral-600">과목:</label>
                    <select id="wrongAnswerSubjectFilter" class="px-3 py-1 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="filterWrongAnswers()">
                      <option value="수학">수학</option>
                      <option value="국어">국어</option>
                      <option value="영어">영어</option>
                      <option value="과학탐구">과학탐구</option>
                      <option value="사회탐구">사회탐구</option>
                      <option value="한국사">한국사</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="p-6">
                <div id="wrongAnswerList" class="space-y-3">
                  <!-- 동적으로 생성되는 오답률 목록 -->
                </div>
              </div>
            </div>
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">단원별 약점</h3>
              </div>
              <div class="p-6 text-sm text-neutral-700">
                <ul class="list-disc list-inside space-y-1">
                  <li>확률과 통계 - 확률분포</li>
                  <li>미적분 - 도함수의 활용</li>
                  <li>기하 - 평면벡터</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="rounded-2xl border bg-white">
            <div class="p-6 border-b">
              <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold">추천 학습 (유료)</h3>
                <div class="flex items-center gap-2">
                  <span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">SNarGPT</span>
                  <span class="text-sm text-gray-600">AI 변형문제 생성</span>
                </div>
              </div>
            </div>
            <div class="p-6">
              <!-- 오답리스트 섹션 -->
              <div class="mb-6">
                <h4 class="text-md font-semibold mb-3">내 오답리스트</h4>
                <div id="wrongAnswersForAI" class="space-y-2 max-h-40 overflow-y-auto border rounded-lg p-3 bg-gray-50">
                  <!-- 동적으로 생성되는 오답리스트 -->
                </div>
              </div>
              
              <!-- 변형문제 생성 섹션 -->
              <div class="border-t pt-4">
                <div class="flex items-center justify-between mb-4">
                  <div>
                    <h4 class="text-md font-semibold">AI 변형문제 생성</h4>
                    <p class="text-sm text-gray-600">오답한 문제와 유사한 변형문제를 생성합니다</p>
                  </div>
                  <div class="text-right">
                    <div class="text-sm text-gray-500">생성 비용</div>
                    <div class="text-lg font-bold text-blue-600">₩2,000</div>
                  </div>
                </div>
                
                <div class="grid gap-4 md:grid-cols-2">
                  <div class="space-y-3">
                    <div>
                      <label class="text-sm font-medium text-gray-700">문제 개수</label>
                      <select id="problemCount" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="5">5문제</option>
                        <option value="10" selected>10문제</option>
                        <option value="15">15문제</option>
                        <option value="20">20문제</option>
                      </select>
                    </div>
                    <div>
                      <label class="text-sm font-medium text-gray-700">난이도</label>
                      <select id="difficultyLevel" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="mixed">혼합</option>
                        <option value="easy">쉬움</option>
                        <option value="medium">보통</option>
                        <option value="hard">어려움</option>
                      </select>
                    </div>
                  </div>
                  
                  <div class="space-y-3">
                    <div>
                      <label class="text-sm font-medium text-gray-700">과목 필터</label>
                      <select id="aiSubjectFilter" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="updateWrongAnswersForAI()">
                        <option value="all">전체 과목</option>
                        <option value="수학">수학</option>
                        <option value="국어">국어</option>
                        <option value="영어">영어</option>
                        <option value="과학탐구">과학탐구</option>
                        <option value="사회탐구">사회탐구</option>
                        <option value="한국사">한국사</option>
                      </select>
                    </div>
                    <div>
                      <label class="text-sm font-medium text-gray-700">변형 유형</label>
                      <select id="variationType" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="similar">유사 문제</option>
                        <option value="concept">개념 중심</option>
                        <option value="application">응용 문제</option>
                        <option value="mixed">혼합 유형</option>
                      </select>
                    </div>
                  </div>
                </div>
                
                <div class="mt-6 flex gap-3">
                  <button id="generateProblemsBtn" class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200 flex items-center justify-center gap-2" onclick="generateVariationProblems()">
                    <i data-lucide="zap" class="w-4 h-4"></i>
                    변형문제 생성하기
                  </button>
                  <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-colors">
                    미리보기
                  </button>
                </div>
                
                <!-- 생성된 문제 미리보기 -->
                <div id="generatedProblemsPreview" class="mt-6 hidden">
                  <div class="border rounded-lg p-4 bg-green-50">
                    <div class="flex items-center gap-2 mb-3">
                      <i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>
                      <span class="font-semibold text-green-800">변형문제 생성 완료!</span>
                    </div>
                    <div id="generatedProblemsList" class="space-y-2">
                      <!-- 생성된 문제 목록이 여기에 표시됩니다 -->
                    </div>
                    <div class="mt-4 flex gap-2">
                      <button class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-semibold hover:bg-green-700">
                        문제 풀기
                      </button>
                      <button class="px-4 py-2 border border-green-600 text-green-600 rounded-lg text-sm font-semibold hover:bg-green-50">
                        PDF 다운로드
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Admin Dashboard -->
      <section class="page" id="page-admin">
        <div class="space-y-6">
          <div class="mb-2">
            <h2 class="text-xl font-semibold">관리자 대시보드</h2>
            <p class="text-sm text-neutral-600">학원 전체 지표와 운영 도구</p>
          </div>

          <div class="grid gap-6 md:grid-cols-4">
            <div class="rounded-2xl bg-neutral-100 p-4">
              <div class="text-xs text-neutral-500">누적 채점 수</div>
              <div class="text-2xl font-semibold">12,482</div>
            </div>
            <div class="rounded-2xl bg-neutral-100 p-4">
              <div class="text-xs text-neutral-500">주간 활성 사용자</div>
              <div class="text-2xl font-semibold">386</div>
            </div>
            <div class="rounded-2xl bg-neutral-100 p-4">
              <div class="text-xs text-neutral-500">평균 점수</div>
              <div class="text-2xl font-semibold">78.4</div>
            </div>
            <div class="rounded-2xl bg-neutral-100 p-4">
              <div class="text-xs text-neutral-500">서버 상태</div>
              <div class="text-2xl font-semibold">정상</div>
            </div>
          </div>

          <div class="grid gap-6 md:grid-cols-2">
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">반/그룹별 평균</h3>
              </div>
              <div class="p-6 grid h-48 place-items-center rounded-xl bg-neutral-100 text-xs text-neutral-500">그룹별 바 차트
                (와이어프레임)</div>
            </div>
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">오답률 상위 유형 Top 10</h3>
              </div>
              <div class="p-6 text-sm text-neutral-700">
                <ol class="list-decimal list-inside space-y-1">
                  <li>유형 1</li>
                  <li>유형 2</li>
                  <li>유형 3</li>
                  <li>유형 4</li>
                  <li>유형 5</li>
                  <li>유형 6</li>
                  <li>유형 7</li>
                  <li>유형 8</li>
                  <li>유형 9</li>
                  <li>유형 10</li>
                </ol>
              </div>
            </div>
          </div>

          <div class="rounded-2xl border bg-white">
            <div class="p-6 border-b">
              <h3 class="text-lg font-semibold">운영 설정</h3>
            </div>
            <div class="p-6 grid gap-3 md:grid-cols-3">
              <div class="space-y-1">
                <label class="text-sm font-medium">학원 코드</label>
                <input class="w-full rounded-xl border px-3 py-2 text-sm" placeholder="SN-ACADEMY-001" />
              </div>
              <div class="space-y-1">
                <label class="text-sm font-medium">CSV 내보내기</label><br />
                <button class="px-3 py-2 rounded-xl border text-sm">다운로드</button>
              </div>
              <div class="space-y-1">
                <label class="text-sm font-medium">서술형 검토 워크플로우</label>
                <select class="w-full rounded-xl border px-3 py-2 text-sm">
                  <option>자동→수동 검토</option>
                  <option>전량 수동 검토</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Announcements -->
      <section class="page" id="page-announce">
        <div class="space-y-6">
          <div class="mb-2">
            <h2 class="text-xl font-semibold">공지사항 & 업데이트</h2>
          </div>
          <div class="rounded-2xl border bg-white">
            <div class="divide-y">
              <div class="p-6">
                <div class="text-sm font-semibold">v0.1.0 릴리즈</div>
                <div class="text-xs text-neutral-600">- OCR 속도 개선 - 오답 하이라이트 품질 개선 - 버그 수정</div>
              </div>
              <div class="p-6">
                <div class="text-sm font-semibold">v0.2.0 릴리즈</div>
                <div class="text-xs text-neutral-600">- 관리자 대시보드 추가 - CSV 내보내기</div>
              </div>
              <div class="p-6">
                <div class="text-sm font-semibold">v0.3.0 릴리즈</div>
                <div class="text-xs text-neutral-600">- 서술형 검토 워크플로우 베타</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- FAQ & Support -->
      <section class="page" id="page-faq">
        <div class="space-y-6">
          <div class="mb-2">
            <h2 class="text-xl font-semibold">FAQ & 고객센터</h2>
          </div>
          <div class="grid gap-6 md:grid-cols-2">
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">자주 묻는 질문</h3>
              </div>
              <div class="p-6 space-y-3 text-sm">
                <details class="rounded-xl border p-3">
                  <summary class="cursor-pointer font-medium">사진이 흐릴 때도 인식되나요?</summary>
                  <p class="mt-2 text-neutral-600">가능하나 정확도는 낮아질 수 있습니다. 광량 확보를 권장합니다.</p>
                </details>
                <details class="rounded-xl border p-3">
                  <summary class="cursor-pointer font-medium">서술형도 채점되나요?</summary>
                  <p class="mt-2 text-neutral-600">서술형은 OCR+규칙 기반 제안 후 수동 검토 단계를 제공합니다.</p>
                </details>
                <details class="rounded-xl border p-3">
                  <summary class="cursor-pointer font-medium">개인정보는 안전한가요?</summary>
                  <p class="mt-2 text-neutral-600">최소 수집 원칙 및 암호화 저장을 적용합니다.</p>
                </details>
              </div>
            </div>

            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">문의하기</h3>
              </div>
              <div class="p-6 space-y-3">
                <input class="w-full rounded-xl border px-3 py-2" placeholder="이메일" />
                <textarea class="w-full rounded-xl border px-3 py-2 h-32" placeholder="문의 내용을 적어주세요"></textarea>
                <button class="px-4 py-2 rounded-xl bg-black text-white">전송</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Pricing -->
      <section class="page" id="page-pricing">
        <div class="space-y-6">
          <div class="mb-2">
            <h2 class="text-xl font-semibold">요금제</h2>
            <p class="text-sm text-neutral-600">MVP 단계에서는 무료 체험 위주로 운영</p>
          </div>
          <div class="grid gap-6 md:grid-cols-3">
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">Free</h3>
              </div>
              <div class="p-6 space-y-3">
                <div class="text-3xl font-semibold">₩0</div>
                <ul class="list-disc list-inside text-sm text-neutral-700 space-y-1">
                  <li>월 100채점</li>
                  <li>기본 분석</li>
                  <li>오답노트</li>
                </ul>
                <button class="w-full px-4 py-2 rounded-xl bg-black text-white">시작하기</button>
              </div>
            </div>
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">Pro</h3>
              </div>
              <div class="p-6 space-y-3">
                <div class="text-3xl font-semibold">₩9,900</div>
                <ul class="list-disc list-inside text-sm text-neutral-700 space-y-1">
                  <li>무제한 채점</li>
                  <li>고급 분석</li>
                  <li>CSV/PDF</li>
                  <li>우선 지원</li>
                </ul>
                <button class="w-full px-4 py-2 rounded-xl bg-black text-white">시작하기</button>
              </div>
            </div>
            <div class="rounded-2xl border bg-white">
              <div class="p-6 border-b">
                <h3 class="text-lg font-semibold">Academy</h3>
              </div>
              <div class="p-6 space-y-3">
                <div class="text-3xl font-semibold">맞춤형</div>
                <ul class="list-disc list-inside text-sm text-neutral-700 space-y-1">
                  <li>반/학년 대시보드</li>
                  <li>SSO/초대코드</li>
                  <li>API 연동</li>
                </ul>
                <button class="w-full px-4 py-2 rounded-xl bg-black text-white">문의하기</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Legal -->
      <section class="page" id="page-legal">
        <div class="space-y-6">
          <div class="mb-2">
            <h2 class="text-xl font-semibold">법률 정보</h2>
            <p class="text-sm text-neutral-600">약관 및 개인정보처리방침 (샘플)</p>
          </div>
          <div class="rounded-2xl border bg-white p-6 space-y-4 text-sm text-neutral-700">
            <div>
              <div class="mb-1 font-semibold">이용약관 (요약)</div>
              <p>서비스는 학습 지원 목적이며, 부정 행위 방지를 위해 사용 기록을 보관할 수 있습니다.</p>
            </div>
            <div>
              <div class="mb-1 font-semibold">개인정보처리방침 (요약)</div>
              <p>점수/오답 통계를 익명화 후 분석에 활용할 수 있으며, 동의 철회 시 즉시 중단합니다.</p>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Exam Selection Modal -->
  <div id="examModal" class="modal fixed inset-0 z-40 place-items-center bg-black/40 p-4">
    <div class="w-full max-w-2xl max-h-[90vh] rounded-2xl bg-white shadow-xl flex flex-col" onclick="event.stopPropagation()">
      <div class="flex-shrink-0 p-6 border-b">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold">시험 선택</h3>
          <button id="closeExam" class="px-2 py-1 text-sm rounded-lg hover:bg-neutral-100">닫기</button>
        </div>
      </div>
      <div class="flex-1 overflow-y-auto p-6 space-y-4">
        <!-- 학년도 선택 -->
        <div class="space-y-2">
          <label class="text-sm font-medium">학년도</label>
          <select id="examYear" class="w-full rounded-xl border px-3 py-2 text-sm">
            <option value="">학년도를 선택하세요</option>
          </select>
        </div>

        <!-- 평가기관 선택 -->
        <div class="space-y-2">
          <label class="text-sm font-medium">평가기관</label>
          <div class="space-y-2">
            <div class="grid grid-cols-2 gap-2">
              <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                <input type="radio" name="examAgency" value="evaluation" class="exam-agency-radio">
                <span class="text-sm">평가원</span>
              </label>
              <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                <input type="radio" name="examAgency" value="education" class="exam-agency-radio">
                <span class="text-sm">교육청</span>
              </label>
              <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                <input type="radio" name="examAgency" value="sidaein" class="exam-agency-radio">
                <span class="text-sm">시대인재</span>
              </label>
              <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                <input type="radio" name="examAgency" value="megastudy" class="exam-agency-radio">
                <span class="text-sm">메가스터디</span>
              </label>
              <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                <input type="radio" name="examAgency" value="custom" class="exam-agency-radio">
                <span class="text-sm">직접입력</span>
              </label>
            </div>
            <input id="customAgency" type="text" placeholder="평가기관을 직접 입력하세요" 
                   class="w-full rounded-xl border px-3 py-2 text-sm hidden" />
          </div>
        </div>

        <!-- 시행월 선택 -->
        <div class="space-y-2">
          <label class="text-sm font-medium">시행월</label>
          <select id="examMonth" class="w-full rounded-xl border px-3 py-2 text-sm">
            <option value="">시행월을 선택하세요</option>
          </select>
        </div>

        <!-- 과목 선택 -->
        <div class="space-y-2">
          <label class="text-sm font-medium">과목</label>
          <div class="space-y-3">
            <!-- 기본 과목 -->
            <div class="space-y-3">
              <!-- 국어 -->
              <div>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="radio" name="subject" value="korean" class="subject-radio" id="koreanRadio" onchange="handleSubjectChange('korean')">
                  <span class="text-sm">국어</span>
                </label>
                <!-- 국어 하위 과목 -->
                <div id="koreanSubjects" class="mt-2 ml-4 grid grid-cols-2 gap-2 hidden">
                  <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                    <input type="radio" name="koreanSubject" value="speech-writing">
                    <span class="text-sm">화법과작문</span>
                  </label>
                  <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                    <input type="radio" name="koreanSubject" value="language-media">
                    <span class="text-sm">언어와매체</span>
                  </label>
                </div>
              </div>

              <!-- 수학 -->
              <div>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="radio" name="subject" value="math" class="subject-radio" id="mathRadio" onchange="handleSubjectChange('math')">
                  <span class="text-sm">수학</span>
                </label>
                <!-- 수학 하위 과목 -->
                <div id="mathSubjects" class="mt-2 ml-4 grid grid-cols-2 gap-2 hidden">
                  <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                    <input type="radio" name="mathSubject" value="probability-statistics">
                    <span class="text-sm">확률과통계</span>
                  </label>
                  <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                    <input type="radio" name="mathSubject" value="calculus">
                    <span class="text-sm">미분과적분</span>
                  </label>
                  <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                    <input type="radio" name="mathSubject" value="geometry">
                    <span class="text-sm">기하</span>
                  </label>
                </div>
              </div>

              <!-- 영어 -->
              <div>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="radio" name="subject" value="english" class="subject-radio">
                  <span class="text-sm">영어</span>
                </label>
              </div>

              <!-- 한국사 -->
              <div>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="radio" name="subject" value="korean-history" class="subject-radio">
                  <span class="text-sm">한국사</span>
                </label>
              </div>
            </div>

            <!-- 과학탐구 -->
            <div>
              <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                <input type="radio" name="subject" value="science" class="subject-radio" id="scienceRadio" onchange="handleSubjectChange('science')">
                <span class="text-sm">과학탐구</span>
                <span class="text-xs text-red-500">(2과목 선택 필수)</span>
              </label>
              <div id="scienceSubjects" class="mt-2 ml-4 grid grid-cols-2 gap-2 hidden">
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="scienceSubject" value="physics1" onchange="handleScienceSubjectChange()">
                  <span class="text-sm">물리1</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="scienceSubject" value="physics2" onchange="handleScienceSubjectChange()">
                  <span class="text-sm">물리2</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="scienceSubject" value="chemistry1" onchange="handleScienceSubjectChange()">
                  <span class="text-sm">화학1</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="scienceSubject" value="chemistry2" onchange="handleScienceSubjectChange()">
                  <span class="text-sm">화학2</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="scienceSubject" value="biology1" onchange="handleScienceSubjectChange()">
                  <span class="text-sm">생명과학1</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="scienceSubject" value="biology2" onchange="handleScienceSubjectChange()">
                  <span class="text-sm">생명과학2</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="scienceSubject" value="earth1" onchange="handleScienceSubjectChange()">
                  <span class="text-sm">지구과학1</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="scienceSubject" value="earth2" onchange="handleScienceSubjectChange()">
                  <span class="text-sm">지구과학2</span>
                </label>
              </div>
            </div>

            <!-- 사회탐구 -->
            <div>
              <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                <input type="radio" name="subject" value="social" class="subject-radio" id="socialRadio" onchange="handleSubjectChange('social')">
                <span class="text-sm">사회탐구</span>
                <span class="text-xs text-red-500">(2과목 선택 필수)</span>
              </label>
              <div id="socialSubjects" class="mt-2 ml-4 grid grid-cols-2 gap-2 hidden">
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="socialSubject" value="social-culture" onchange="handleSocialSubjectChange()">
                  <span class="text-sm">사회문화</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="socialSubject" value="ethics-ideology" onchange="handleSocialSubjectChange()">
                  <span class="text-sm">윤리와사상</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="socialSubject" value="life-ethics" onchange="handleSocialSubjectChange()">
                  <span class="text-sm">생활과윤리</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="socialSubject" value="korean-geography" onchange="handleSocialSubjectChange()">
                  <span class="text-sm">한국지리</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="socialSubject" value="world-geography" onchange="handleSocialSubjectChange()">
                  <span class="text-sm">세계지리</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="socialSubject" value="economics" onchange="handleSocialSubjectChange()">
                  <span class="text-sm">경제</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="socialSubject" value="east-asian-history" onchange="handleSocialSubjectChange()">
                  <span class="text-sm">동아시아사</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="socialSubject" value="world-history" onchange="handleSocialSubjectChange()">
                  <span class="text-sm">세계사</span>
                </label>
                <label class="flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-neutral-50">
                  <input type="checkbox" name="socialSubject" value="politics-law" onchange="handleSocialSubjectChange()">
                  <span class="text-sm">정치와법</span>
                </label>
              </div>
            </div>

            <!-- 직접입력 옵션 -->
            <div class="space-y-3">
              <div class="flex items-center gap-2">
                <input type="checkbox" id="customSubjectCheck" class="rounded" onchange="handleCustomSubjectChange()">
                <label for="customSubjectCheck" class="text-sm">직접입력</label>
              </div>
              
              <div id="customSubjectForm" class="space-y-3 hidden">
                <input id="customSubject" type="text" placeholder="과목명을 입력하세요" 
                       class="w-full rounded-xl border px-3 py-2 text-sm" />
                
                <div class="space-y-2">
                  <label class="text-sm font-medium">문항 구성</label>
                  <div class="grid grid-cols-2 gap-3">
                    <div>
                      <label class="text-xs text-neutral-600">객관식 문항 수</label>
                      <select id="customObjectiveCount" class="w-full rounded-lg border px-3 py-2 text-sm">
                        <option value="0">0문항</option>
                        <option value="5">5문항</option>
                        <option value="10">10문항</option>
                        <option value="15">15문항</option>
                        <option value="20">20문항</option>
                        <option value="25">25문항</option>
                        <option value="30">30문항</option>
                        <option value="35">35문항</option>
                        <option value="40">40문항</option>
                        <option value="45">45문항</option>
                      </select>
                    </div>
                    <div>
                      <label class="text-xs text-neutral-600">주관식 문항 수</label>
                      <select id="customSubjectiveCount" class="w-full rounded-lg border px-3 py-2 text-sm">
                        <option value="0">0문항</option>
                        <option value="5">5문항</option>
                        <option value="10">10문항</option>
                        <option value="15">15문항</option>
                        <option value="20">20문항</option>
                        <option value="25">25문항</option>
                        <option value="30">30문항</option>
                        <option value="35">35문항</option>
                        <option value="40">40문항</option>
                        <option value="45">45문항</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
      <!-- 확인 버튼 (고정) -->
      <div class="flex-shrink-0 p-6 border-t bg-neutral-50">
        <div class="flex justify-end gap-2">
          <button id="cancelExam" class="px-4 py-2 rounded-xl border text-sm">취소</button>
          <button id="confirmExam" class="px-4 py-2 rounded-xl bg-black text-white text-sm">확인</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Answer Input Modal -->
  <div id="answerModal" class="modal fixed inset-0 z-40 place-items-center bg-black/40 p-4">
    <div class="w-full max-w-4xl max-h-[90vh] rounded-2xl bg-white shadow-xl flex flex-col" onclick="event.stopPropagation()">
      <div class="flex-shrink-0 p-6 border-b">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold">정답 입력</h3>
          <button id="closeAnswer" class="px-2 py-1 text-sm rounded-lg hover:bg-neutral-100">닫기</button>
        </div>
      </div>
      <div class="flex-1 overflow-y-auto p-6">
        <div id="answerInputContent">
          <!-- 동적으로 생성될 정답 입력 폼 -->
        </div>
      </div>
      <div class="flex-shrink-0 p-6 border-t bg-neutral-50">
        <div class="flex justify-end gap-2">
          <button id="cancelAnswer" class="px-4 py-2 rounded-xl border text-sm">취소</button>
          <button id="confirmAnswer" class="px-4 py-2 rounded-xl bg-black text-white text-sm">확인</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 기존 정답 찾기 모달 -->
  <div id="searchModal" class="modal fixed inset-0 z-40 place-items-center bg-black/40 p-4">
    <div class="w-full max-w-4xl max-h-[90vh] rounded-2xl bg-white shadow-xl flex flex-col" onclick="event.stopPropagation()">
      <div class="flex-shrink-0 p-6 border-b">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold">기존 입력된 정답 찾기</h3>
          <button id="closeSearch" class="px-2 py-1 text-sm rounded-lg hover:bg-neutral-100">닫기</button>
        </div>
      </div>
      <div class="flex-1 overflow-y-auto p-6">
        <!-- 검색창 -->
        <div class="mb-6">
          <div class="relative">
            <input 
              type="text" 
              id="searchInput" 
              placeholder="시험명, 과목명, 학년도로 검색하세요..." 
              class="w-full px-4 py-3 pl-10 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            >
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- 검색 결과 -->
        <div id="searchResults" class="space-y-3">
          <!-- 검색 결과가 여기에 동적으로 생성됩니다 -->
        </div>

        <!-- 빈 상태 -->
        <div id="emptyState" class="text-center py-8 hidden">
          <div class="w-16 h-16 mx-auto mb-4 bg-neutral-100 rounded-full flex items-center justify-center">
            <svg class="w-8 h-8 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-neutral-800 mb-2">검색 결과가 없습니다</h3>
          <p class="text-neutral-600">다른 검색어를 시도해보세요.</p>
        </div>
      </div>
      <div class="flex-shrink-0 p-6 border-t bg-neutral-50">
        <div class="flex justify-end gap-2">
          <button id="cancelSearch" class="px-4 py-2 rounded-xl border text-sm">취소</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Auth Modal -->
  <div id="authModal" class="modal fixed inset-0 z-40 place-items-center bg-black/40 p-4">
    <div class="w-full max-w-md rounded-2xl bg-white p-6 shadow-xl" onclick="event.stopPropagation()">
      <div class="mb-4 flex items-center justify-between">
        <h3 id="authTitle" class="text-lg font-semibold">로그인</h3>
        <button id="closeAuth" class="px-2 py-1 text-sm rounded-lg hover:bg-neutral-100">닫기</button>
      </div>
      <div class="space-y-3">
        <div id="signupExtra" class="hidden">
          <input class="w-full rounded-xl border px-3 py-2" placeholder="이름" />
          <div class="grid grid-cols-2 gap-2">
            <input class="rounded-xl border px-3 py-2" placeholder="학교" />
            <input class="rounded-xl border px-3 py-2" placeholder="학년" />
          </div>
        </div>
        <input class="w-full rounded-xl border px-3 py-2" placeholder="이메일" />
        <input class="w-full rounded-xl border px-3 py-2" placeholder="비밀번호" type="password" />
        <div id="inviteRow" class="hidden flex items-center justify-between rounded-xl border p-3">
          <div>
            <div class="text-sm font-medium">학원 전용 초대코드</div>
            <div class="text-xs text-neutral-500">있다면 입력 (선택)</div>
          </div>
          <input class="w-40 rounded-xl border px-3 py-2 text-sm" placeholder="INVITE-XXXX" />
        </div>
        <button id="authPrimary" class="w-full px-4 py-2 rounded-xl bg-black text-white">로그인</button>
        <button class="w-full px-4 py-2 rounded-xl border">소셜 로그인 (Google/Kakao)</button>
        <div class="text-center text-sm text-neutral-600">
          <span id="toggleAuthText">계정이 없나요? <button id="toSignup" class="underline">회원가입</button></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="border-t bg-white">
    <div class="mx-auto max-w-7xl px-4 py-6 text-xs text-neutral-500">
      © <span id="year"></span> SN독학기숙학원 · SNar OCR · All rights reserved.
    </div>
  </footer>

  <script>
    // 사이드바 항목 설정
    const NAV = [
      { id: 'landing', label: 'Landing', icon: 'home' },
      { id: 'upload', label: 'Upload & Grade', icon: 'upload' },
      { id: 'result', label: 'Result', icon: 'file-text' },
      { id: 'mypage', label: 'My Page (Student)', icon: 'user' },
      { id: 'teacher-mypage', label: 'My Page (Teacher)', icon: 'users' },
      { id: 'analytics', label: 'Analytics', icon: 'bar-chart-3' },
      { id: 'admin', label: 'Admin', icon: 'layout-dashboard' },
      { id: 'announce', label: 'Announcements', icon: 'megaphone' },
      { id: 'faq', label: 'FAQ & Support', icon: 'help-circle' },
      { id: 'pricing', label: 'Pricing', icon: 'credit-card' },
      { id: 'legal', label: 'Legal', icon: 'shield' },
    ];

    const sidebar = document.getElementById('sidebar');
    const pages = document.querySelectorAll('.page');

    function goto(id) {
      pages.forEach(p => p.classList.remove('active'));
      const el = document.getElementById('page-' + id);
      if (el) el.classList.add('active');
      // 사이드바 active 표시
      document.querySelectorAll('#sidebar button').forEach(btn => {
        if (btn.dataset.page === id) {
          btn.classList.add('bg-black', 'text-white');
          btn.classList.remove('hover:bg-neutral-100', 'text-neutral-800');
        } else {
          btn.classList.remove('bg-black', 'text-white');
          btn.classList.add('hover:bg-neutral-100', 'text-neutral-800');
        }
      })
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // 사이드바 생성
    NAV.forEach(({ id, label, icon }) => {
      const btn = document.createElement('button');
      btn.className = 'group flex w-full items-center gap-3 rounded-xl px-3 py-2 text-left text-sm transition hover:bg-neutral-100 text-neutral-800';
      btn.dataset.page = id;
      btn.innerHTML = `<i data-lucide="${icon}" class="w-4 h-4"></i> ${label}`;
      btn.addEventListener('click', () => goto(id));
      sidebar.appendChild(btn);
    });

    // 헤더 단축 이동
    document.querySelectorAll('[data-goto]').forEach(el => {
      el.addEventListener('click', () => goto(el.dataset.goto));
    });

    // 인증 모달
    const authModal = document.getElementById('authModal');
    const openAuth = document.getElementById('openAuth');
    const closeAuth = document.getElementById('closeAuth');
    const authTitle = document.getElementById('authTitle');
    const authPrimary = document.getElementById('authPrimary');
    const signupExtra = document.getElementById('signupExtra');
    const inviteRow = document.getElementById('inviteRow');
    const toggleAuthText = document.getElementById('toggleAuthText');
    const toSignup = document.getElementById('toSignup');

    let isSignUp = false;
    function renderAuth() {
      authTitle.textContent = isSignUp ? '회원가입' : '로그인';
      authPrimary.textContent = isSignUp ? '가입하기' : '로그인';
      signupExtra.classList.toggle('hidden', !isSignUp);
      inviteRow.classList.toggle('hidden', !isSignUp);
      toggleAuthText.innerHTML = isSignUp
        ? '이미 계정이 있나요? <button id="toLogin" class="underline">로그인</button>'
        : '계정이 없나요? <button id="toSignup" class="underline">회원가입</button>';
      // 새로 삽입된 버튼 이벤트 재바인딩
      const toLoginBtn = document.getElementById('toLogin');
      const toSignupBtn = document.getElementById('toSignup');
      if (toLoginBtn) toLoginBtn.onclick = () => { isSignUp = false; renderAuth(); };
      if (toSignupBtn) toSignupBtn.onclick = () => { isSignUp = true; renderAuth(); };
    }

    openAuth.addEventListener('click', () => { authModal.classList.add('open'); renderAuth(); });
    closeAuth.addEventListener('click', () => authModal.classList.remove('open'));
    authModal.addEventListener('click', () => authModal.classList.remove('open'));

    // 초기 페이지 상태
    goto('landing');

    // 아이콘 렌더링
    lucide.createIcons();

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Analytics 페이지 그래프 초기화
    initializeAnalyticsCharts();

    // 오답률 데이터 초기화
    initializeWrongAnswerData();

    // 점수 추이 차트 초기화
    initializeScoreTrendChart();

    // 오답노트 데이터 초기화
    initializeWrongNotesData();

    // AI 변형문제 생성 데이터 초기화
    initializeAIProblemGeneration();

    // 반별 채점인원 및 평균점수 그래프 초기화
    function initializeAnalyticsCharts() {
      // 반별 채점인원 그래프
      const participationCtx = document.getElementById('classParticipationChart');
      if (participationCtx) {
        new Chart(participationCtx, {
          type: 'bar',
          data: {
            labels: ['1반', '2반', '3반', '4반', '5반', '6반'],
            datasets: [{
              label: '채점인원',
              data: [28, 32, 25, 30, 27, 29],
              backgroundColor: [
                'rgba(59, 130, 246, 0.8)',
                'rgba(16, 185, 129, 0.8)',
                'rgba(245, 158, 11, 0.8)',
                'rgba(239, 68, 68, 0.8)',
                'rgba(139, 92, 246, 0.8)',
                'rgba(236, 72, 153, 0.8)'
              ],
              borderColor: [
                'rgba(59, 130, 246, 1)',
                'rgba(16, 185, 129, 1)',
                'rgba(245, 158, 11, 1)',
                'rgba(239, 68, 68, 1)',
                'rgba(139, 92, 246, 1)',
                'rgba(236, 72, 153, 1)'
              ],
              borderWidth: 2,
              borderRadius: 8,
              borderSkipped: false,
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.parsed.y + '명';
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 40,
                ticks: {
                  stepSize: 5,
                  callback: function(value) {
                    return value + '명';
                  }
                },
                grid: {
                  color: 'rgba(0, 0, 0, 0.1)'
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });
      }

      // 반별 평균점수 그래프
      const averageCtx = document.getElementById('classAverageChart');
      if (averageCtx) {
        new Chart(averageCtx, {
          type: 'bar',
          data: {
            labels: ['1반', '2반', '3반', '4반', '5반', '6반'],
            datasets: [{
              label: '평균점수',
              data: [78.5, 82.3, 76.2, 81.5, 79.3, 77.8],
              backgroundColor: [
                'rgba(59, 130, 246, 0.8)',
                'rgba(16, 185, 129, 0.8)',
                'rgba(245, 158, 11, 0.8)',
                'rgba(239, 68, 68, 0.8)',
                'rgba(139, 92, 246, 0.8)',
                'rgba(236, 72, 153, 0.8)'
              ],
              borderColor: [
                'rgba(59, 130, 246, 1)',
                'rgba(16, 185, 129, 1)',
                'rgba(245, 158, 11, 1)',
                'rgba(239, 68, 68, 1)',
                'rgba(139, 92, 246, 1)',
                'rgba(236, 72, 153, 1)'
              ],
              borderWidth: 2,
              borderRadius: 8,
              borderSkipped: false,
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.parsed.y + '점';
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                ticks: {
                  stepSize: 10,
                  callback: function(value) {
                    return value + '점';
                  }
                },
                grid: {
                  color: 'rgba(0, 0, 0, 0.1)'
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });
      }
    }

    // 오답률 데이터 초기화
    function initializeWrongAnswerData() {
      // 기본적으로 수학 데이터를 표시
      filterWrongAnswers();
    }

    // 과목별 오답률 데이터
    const wrongAnswerData = {
      '수학': [
        { problem: '미적분 - 도함수의 활용', wrongRate: 85.2, wrongCount: 128, totalCount: 150 },
        { problem: '확률과 통계 - 확률분포', wrongRate: 78.5, wrongCount: 118, totalCount: 150 },
        { problem: '기하 - 평면벡터', wrongRate: 72.3, wrongCount: 108, totalCount: 150 },
        { problem: '미적분 - 적분의 활용', wrongRate: 68.7, wrongCount: 103, totalCount: 150 },
        { problem: '수열 - 극한', wrongRate: 65.4, wrongCount: 98, totalCount: 150 },
        { problem: '함수 - 삼각함수', wrongRate: 62.1, wrongCount: 93, totalCount: 150 },
        { problem: '지수와 로그', wrongRate: 58.9, wrongCount: 88, totalCount: 150 },
        { problem: '방정식과 부등식', wrongRate: 55.3, wrongCount: 83, totalCount: 150 },
        { problem: '집합과 명제', wrongRate: 52.7, wrongCount: 79, totalCount: 150 },
        { problem: '수와 연산', wrongRate: 48.6, wrongCount: 73, totalCount: 150 }
      ],
      '국어': [
        { problem: '문학 - 현대시 감상', wrongRate: 82.1, wrongCount: 123, totalCount: 150 },
        { problem: '문법 - 문장 성분', wrongRate: 76.8, wrongCount: 115, totalCount: 150 },
        { problem: '독서 - 논리적 사고', wrongRate: 73.4, wrongCount: 110, totalCount: 150 },
        { problem: '문학 - 고전소설', wrongRate: 69.7, wrongCount: 105, totalCount: 150 },
        { problem: '화법과 작문', wrongRate: 66.2, wrongCount: 99, totalCount: 150 },
        { problem: '문법 - 어휘', wrongRate: 63.5, wrongCount: 95, totalCount: 150 },
        { problem: '독서 - 정보 처리', wrongRate: 59.8, wrongCount: 90, totalCount: 150 },
        { problem: '문학 - 현대소설', wrongRate: 56.3, wrongCount: 84, totalCount: 150 },
        { problem: '문법 - 표준어', wrongRate: 53.1, wrongCount: 80, totalCount: 150 },
        { problem: '독서 - 비판적 사고', wrongRate: 49.7, wrongCount: 75, totalCount: 150 }
      ],
      '영어': [
        { problem: '문법 - 시제', wrongRate: 79.3, wrongCount: 119, totalCount: 150 },
        { problem: '어휘 - 동의어/반의어', wrongRate: 74.6, wrongCount: 112, totalCount: 150 },
        { problem: '독해 - 추론 문제', wrongRate: 71.2, wrongCount: 107, totalCount: 150 },
        { problem: '문법 - 접속사', wrongRate: 67.8, wrongCount: 102, totalCount: 150 },
        { problem: '독해 - 주제 찾기', wrongRate: 64.5, wrongCount: 97, totalCount: 150 },
        { problem: '어휘 - 구동사', wrongRate: 61.3, wrongCount: 92, totalCount: 150 },
        { problem: '문법 - 관계사', wrongRate: 58.1, wrongCount: 87, totalCount: 150 },
        { problem: '독해 - 세부사항', wrongRate: 54.9, wrongCount: 82, totalCount: 150 },
        { problem: '어휘 - 관용표현', wrongRate: 51.7, wrongCount: 78, totalCount: 150 },
        { problem: '문법 - 가정법', wrongRate: 48.5, wrongCount: 73, totalCount: 150 }
      ],
      '과학탐구': [
        { problem: '물리1 - 운동과 에너지', wrongRate: 81.7, wrongCount: 123, totalCount: 150 },
        { problem: '화학1 - 원자 구조', wrongRate: 77.4, wrongCount: 116, totalCount: 150 },
        { problem: '생명과학1 - 세포', wrongRate: 73.1, wrongCount: 110, totalCount: 150 },
        { problem: '지구과학1 - 대기', wrongRate: 69.8, wrongCount: 105, totalCount: 150 },
        { problem: '물리1 - 파동', wrongRate: 66.5, wrongCount: 100, totalCount: 150 },
        { problem: '화학1 - 화학 결합', wrongRate: 63.2, wrongCount: 95, totalCount: 150 },
        { problem: '생명과학1 - 유전', wrongRate: 59.9, wrongCount: 90, totalCount: 150 },
        { problem: '지구과학1 - 지각', wrongRate: 56.6, wrongCount: 85, totalCount: 150 },
        { problem: '물리1 - 전자기', wrongRate: 53.3, wrongCount: 80, totalCount: 150 },
        { problem: '화학1 - 산염기', wrongRate: 50.0, wrongCount: 75, totalCount: 150 }
      ],
      '사회탐구': [
        { problem: '한국지리 - 기후', wrongRate: 78.9, wrongCount: 118, totalCount: 150 },
        { problem: '세계지리 - 인구', wrongRate: 75.6, wrongCount: 113, totalCount: 150 },
        { problem: '한국사 - 근현대사', wrongRate: 72.3, wrongCount: 108, totalCount: 150 },
        { problem: '세계사 - 근대사', wrongRate: 69.0, wrongCount: 104, totalCount: 150 },
        { problem: '한국지리 - 지형', wrongRate: 65.7, wrongCount: 99, totalCount: 150 },
        { problem: '세계지리 - 산업', wrongRate: 62.4, wrongCount: 94, totalCount: 150 },
        { problem: '한국사 - 조선사', wrongRate: 59.1, wrongCount: 89, totalCount: 150 },
        { problem: '세계사 - 현대사', wrongRate: 55.8, wrongCount: 84, totalCount: 150 },
        { problem: '한국지리 - 도시', wrongRate: 52.5, wrongCount: 79, totalCount: 150 },
        { problem: '세계지리 - 환경', wrongRate: 49.2, wrongCount: 74, totalCount: 150 }
      ],
      '한국사': [
        { problem: '근현대사 - 일제강점기', wrongRate: 83.4, wrongCount: 125, totalCount: 150 },
        { problem: '조선사 - 정치사', wrongRate: 79.1, wrongCount: 119, totalCount: 150 },
        { problem: '근현대사 - 해방 후', wrongRate: 74.8, wrongCount: 112, totalCount: 150 },
        { problem: '고려사 - 정치사', wrongRate: 70.5, wrongCount: 106, totalCount: 150 },
        { problem: '조선사 - 사회사', wrongRate: 66.2, wrongCount: 99, totalCount: 150 },
        { problem: '근현대사 - 개화기', wrongRate: 61.9, wrongCount: 93, totalCount: 150 },
        { problem: '고려사 - 사회사', wrongRate: 57.6, wrongCount: 86, totalCount: 150 },
        { problem: '조선사 - 경제사', wrongRate: 53.3, wrongCount: 80, totalCount: 150 },
        { problem: '근현대사 - 6.25전쟁', wrongRate: 49.0, wrongCount: 74, totalCount: 150 },
        { problem: '고려사 - 문화사', wrongRate: 44.7, wrongCount: 67, totalCount: 150 }
      ]
    };

    // 오답률 필터링 함수
    function filterWrongAnswers() {
      const selectedSubject = document.getElementById('wrongAnswerSubjectFilter').value;
      const wrongAnswerList = document.getElementById('wrongAnswerList');
      
      if (wrongAnswerData[selectedSubject]) {
        const data = wrongAnswerData[selectedSubject];
        
        wrongAnswerList.innerHTML = data.map((item, index) => `
          <div class="flex items-center justify-between p-3 rounded-lg border hover:bg-gray-50">
            <div class="flex-1">
              <div class="flex items-center gap-3">
                <span class="flex-shrink-0 w-6 h-6 bg-red-100 text-red-800 text-xs font-bold rounded-full flex items-center justify-center">
                  ${index + 1}
                </span>
                <div>
                  <div class="font-medium text-sm">${item.problem}</div>
                  <div class="text-xs text-gray-500">${item.wrongCount}명 오답 / ${item.totalCount}명 참여</div>
                </div>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <div class="text-right">
                <div class="text-lg font-bold text-red-600">${item.wrongRate}%</div>
                <div class="text-xs text-gray-500">오답률</div>
              </div>
              <div class="w-16 h-2 bg-gray-200 rounded-full overflow-hidden">
                <div class="h-full bg-red-500 rounded-full" style="width: ${item.wrongRate}%"></div>
              </div>
            </div>
          </div>
        `).join('');
      }
    }

    // 점수 추이 차트 초기화
    function initializeScoreTrendChart() {
      // 기본적으로 수학 데이터를 표시
      updateScoreTrendChart();
    }

    // 점수 추이 데이터
    const scoreTrendData = {
      '수학': {
        labels: ['2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월'],
        scores: [65, 68, 72, 75, 78, 76, 80, 82, 85, 88],
        color: 'rgba(59, 130, 246, 1)',
        bgColor: 'rgba(59, 130, 246, 0.1)'
      },
      '국어': {
        labels: ['2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월'],
        scores: [70, 73, 76, 78, 81, 79, 83, 85, 87, 90],
        color: 'rgba(16, 185, 129, 1)',
        bgColor: 'rgba(16, 185, 129, 0.1)'
      },
      '영어': {
        labels: ['2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월'],
        scores: [62, 65, 68, 71, 74, 72, 76, 78, 81, 84],
        color: 'rgba(139, 92, 246, 1)',
        bgColor: 'rgba(139, 92, 246, 0.1)'
      },
      '과학탐구': {
        labels: ['2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월'],
        scores: [58, 61, 64, 67, 70, 68, 72, 74, 77, 80],
        color: 'rgba(245, 158, 11, 1)',
        bgColor: 'rgba(245, 158, 11, 0.1)'
      },
      '사회탐구': {
        labels: ['2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월'],
        scores: [63, 66, 69, 72, 75, 73, 77, 79, 82, 85],
        color: 'rgba(239, 68, 68, 1)',
        bgColor: 'rgba(239, 68, 68, 0.1)'
      },
      '한국사': {
        labels: ['2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월'],
        scores: [67, 70, 73, 76, 79, 77, 81, 83, 86, 89],
        color: 'rgba(236, 72, 153, 1)',
        bgColor: 'rgba(236, 72, 153, 0.1)'
      }
    };

    let scoreTrendChartInstance = null;

    // 점수 추이 차트 업데이트
    function updateScoreTrendChart() {
      const selectedSubject = document.getElementById('scoreTrendSubjectFilter').value;
      const ctx = document.getElementById('scoreTrendChart');
      
      if (scoreTrendChartInstance) {
        scoreTrendChartInstance.destroy();
      }

      const data = scoreTrendData[selectedSubject];
      
      scoreTrendChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: '점수',
            data: data.scores,
            borderColor: data.color,
            backgroundColor: data.bgColor,
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: data.color,
            pointBorderColor: '#ffffff',
            pointBorderWidth: 2,
            pointRadius: 6,
            pointHoverRadius: 8,
            pointHoverBackgroundColor: data.color,
            pointHoverBorderColor: '#ffffff',
            pointHoverBorderWidth: 3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.parsed.y + '점';
                }
              },
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleColor: '#ffffff',
              bodyColor: '#ffffff',
              borderColor: data.color,
              borderWidth: 1
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              ticks: {
                stepSize: 10,
                callback: function(value) {
                  return value + '점';
                }
              },
              grid: {
                color: 'rgba(0, 0, 0, 0.1)'
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          },
          elements: {
            point: {
              hoverBackgroundColor: data.color
            }
          }
        }
      });
    }

    // 오답노트 데이터 초기화
    function initializeWrongNotesData() {
      // 기본적으로 전체 데이터를 표시
      filterWrongNotes();
    }

    // 오답노트 데이터
    const wrongNotesData = [
      {
        id: 1,
        subject: '수학',
        subSubject: '미적분',
        examName: '9월 모의고사',
        examDate: '2025-09-15',
        questionNumber: 15,
        question: '함수 f(x) = x³ - 3x + 1의 극값을 구하시오.',
        myAnswer: 'x = 1에서 극대값 3',
        correctAnswer: 'x = ±1에서 극값, x = 1에서 극대값 -1, x = -1에서 극소값 3',
        explanation: 'f\'(x) = 3x² - 3 = 0에서 x = ±1. f\'\'(x) = 6x이므로 x = 1에서 f\'\'(1) = 6 > 0 (극소), x = -1에서 f\'\'(-1) = -6 < 0 (극대)',
        difficulty: '상',
        wrongCount: 3
      },
      {
        id: 2,
        subject: '수학',
        subSubject: '확률과 통계',
        examName: '9월 모의고사',
        examDate: '2025-09-15',
        questionNumber: 22,
        question: '정규분포 N(100, 25)에서 P(X > 110)을 구하시오.',
        myAnswer: '0.1587',
        correctAnswer: '0.0228',
        explanation: 'Z = (110-100)/5 = 2이므로 P(X > 110) = P(Z > 2) = 1 - P(Z ≤ 2) = 1 - 0.9772 = 0.0228',
        difficulty: '중',
        wrongCount: 2
      },
      {
        id: 3,
        subject: '국어',
        subSubject: '문학',
        examName: '9월 모의고사',
        examDate: '2025-09-15',
        questionNumber: 8,
        question: '다음 시에서 화자가 느끼는 감정을 가장 적절하게 표현한 것은?',
        myAnswer: '절망과 좌절',
        correctAnswer: '그리움과 아쉬움',
        explanation: '시의 마지막 구절 "그대를 그리워하며"에서 화자의 감정이 그리움과 아쉬움임을 알 수 있다.',
        difficulty: '중',
        wrongCount: 1
      },
      {
        id: 4,
        subject: '영어',
        subSubject: '문법',
        examName: '9월 모의고사',
        examDate: '2025-09-15',
        questionNumber: 12,
        question: '다음 중 어법상 옳은 것은?',
        myAnswer: 'I wish I was there yesterday.',
        correctAnswer: 'I wish I had been there yesterday.',
        explanation: '과거에 대한 가정법은 had + p.p. 형태를 사용한다. I wish + 주어 + had + p.p.',
        difficulty: '상',
        wrongCount: 4
      },
      {
        id: 5,
        subject: '과학탐구',
        subSubject: '물리1',
        examName: '9월 모의고사',
        examDate: '2025-09-15',
        questionNumber: 18,
        question: '질량 2kg인 물체가 10m/s의 속도로 운동할 때 운동에너지는?',
        myAnswer: '20J',
        correctAnswer: '100J',
        explanation: '운동에너지 = ½mv² = ½ × 2 × 10² = ½ × 2 × 100 = 100J',
        difficulty: '하',
        wrongCount: 1
      },
      {
        id: 6,
        subject: '사회탐구',
        subSubject: '한국지리',
        examName: '9월 모의고사',
        examDate: '2025-09-15',
        questionNumber: 25,
        question: '한국의 기후 특성으로 옳지 않은 것은?',
        myAnswer: '대륙성 기후의 영향으로 일교차가 크다',
        correctAnswer: '연중 고온다습한 열대기후이다',
        explanation: '한국은 온대기후에 속하며, 계절의 변화가 뚜렷하고 여름은 고온다습, 겨울은 저온건조하다.',
        difficulty: '중',
        wrongCount: 2
      },
      {
        id: 7,
        subject: '수학',
        subSubject: '기하',
        examName: '6월 모의고사',
        examDate: '2025-06-15',
        questionNumber: 20,
        question: '벡터 a = (3, 4), b = (1, 2)일 때, a·b의 값은?',
        myAnswer: '11',
        correctAnswer: '11',
        explanation: '벡터의 내적은 a·b = 3×1 + 4×2 = 3 + 8 = 11',
        difficulty: '하',
        wrongCount: 0
      },
      {
        id: 8,
        subject: '국어',
        subSubject: '문법',
        examName: '6월 모의고사',
        examDate: '2025-06-15',
        questionNumber: 14,
        question: '다음 중 표준어가 아닌 것은?',
        myAnswer: '가르치다',
        correctAnswer: '가르치다',
        explanation: '모든 단어가 표준어이다. "가르치다"는 "가르치다"의 표준어 형태이다.',
        difficulty: '중',
        wrongCount: 0
      },
      {
        id: 9,
        subject: '영어',
        subSubject: '독해',
        examName: '6월 모의고사',
        examDate: '2025-06-15',
        questionNumber: 16,
        question: '다음 글의 주제는?',
        myAnswer: '환경 보호의 중요성',
        correctAnswer: '기술 발전의 양면성',
        explanation: '글에서 기술이 편리함을 가져다주지만 동시에 문제점도 있다고 언급하고 있다.',
        difficulty: '중',
        wrongCount: 1
      },
      {
        id: 10,
        subject: '과학탐구',
        subSubject: '화학1',
        examName: '6월 모의고사',
        examDate: '2025-06-15',
        questionNumber: 19,
        question: '원자 번호가 11인 원소의 전자 배치는?',
        myAnswer: '2, 8, 1',
        correctAnswer: '2, 8, 1',
        explanation: '나트륨(Na)의 전자 배치는 K껍질에 2개, L껍질에 8개, M껍질에 1개이다.',
        difficulty: '하',
        wrongCount: 0
      }
    ];

    // 오답노트 필터링 함수
    function filterWrongNotes() {
      const selectedSubject = document.getElementById('wrongNoteSubjectFilter').value;
      const wrongNotesList = document.getElementById('wrongNotesList');
      
      let filteredData = wrongNotesData;
      if (selectedSubject !== 'all') {
        filteredData = wrongNotesData.filter(item => item.subject === selectedSubject);
      }
      
      if (filteredData.length === 0) {
        wrongNotesList.innerHTML = `
          <div class="text-center text-gray-500 py-8">
            <p>선택한 과목의 오답 기록이 없습니다.</p>
          </div>
        `;
        return;
      }
      
      wrongNotesList.innerHTML = filteredData.map(item => `
        <div class="border rounded-lg p-4 hover:bg-gray-50">
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center gap-2">
              <span class="px-2 py-1 text-xs rounded-full ${getSubjectColorClass(item.subject)}">${item.subject}</span>
              <span class="text-sm text-gray-600">${item.subSubject}</span>
              <span class="text-xs text-gray-500">${item.examName}</span>
            </div>
            <div class="text-xs text-gray-500">${item.examDate}</div>
          </div>
          
          <div class="mb-3">
            <div class="flex items-center gap-2 mb-2">
              <span class="w-6 h-6 bg-red-100 text-red-800 text-xs font-bold rounded-full flex items-center justify-center">
                ${item.questionNumber}
              </span>
              <span class="text-sm font-medium">${item.difficulty}급</span>
              <span class="text-xs text-gray-500">${item.wrongCount}회 오답</span>
            </div>
            <div class="text-sm text-gray-800 mb-2">${item.question}</div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
            <div>
              <div class="text-xs text-gray-500 mb-1">내 답안</div>
              <div class="text-sm bg-red-50 text-red-800 p-2 rounded border-l-4 border-red-400">
                ${item.myAnswer}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-500 mb-1">정답</div>
              <div class="text-sm bg-green-50 text-green-800 p-2 rounded border-l-4 border-green-400">
                ${item.correctAnswer}
              </div>
            </div>
          </div>
          
          <div>
            <div class="text-xs text-gray-500 mb-1">해설</div>
            <div class="text-sm text-gray-700 bg-gray-50 p-3 rounded">
              ${item.explanation}
            </div>
          </div>
        </div>
      `).join('');
    }

    // 과목별 색상 클래스 반환
    function getSubjectColorClass(subject) {
      const colors = {
        '수학': 'bg-blue-100 text-blue-800',
        '국어': 'bg-green-100 text-green-800',
        '영어': 'bg-purple-100 text-purple-800',
        '과학탐구': 'bg-orange-100 text-orange-800',
        '사회탐구': 'bg-orange-100 text-orange-800',
        '한국사': 'bg-gray-100 text-gray-800'
      };
      return colors[subject] || 'bg-gray-100 text-gray-800';
    }

    // AI 변형문제 생성 데이터 초기화
    function initializeAIProblemGeneration() {
      // 기본적으로 전체 오답리스트를 표시
      updateWrongAnswersForAI();
    }

    // AI용 오답리스트 업데이트
    function updateWrongAnswersForAI() {
      const selectedSubject = document.getElementById('aiSubjectFilter').value;
      const wrongAnswersContainer = document.getElementById('wrongAnswersForAI');
      
      let filteredData = wrongNotesData;
      if (selectedSubject !== 'all') {
        filteredData = wrongNotesData.filter(item => item.subject === selectedSubject);
      }
      
      if (filteredData.length === 0) {
        wrongAnswersContainer.innerHTML = `
          <div class="text-center text-gray-500 py-4">
            <p>선택한 과목의 오답 기록이 없습니다.</p>
          </div>
        `;
        return;
      }
      
      // 오답 횟수가 1회 이상인 문제만 표시
      const wrongAnswers = filteredData.filter(item => item.wrongCount > 0);
      
      if (wrongAnswers.length === 0) {
        wrongAnswersContainer.innerHTML = `
          <div class="text-center text-gray-500 py-4">
            <p>오답한 문제가 없습니다.</p>
          </div>
        `;
        return;
      }
      
      wrongAnswersContainer.innerHTML = wrongAnswers.map(item => `
        <div class="flex items-center justify-between p-2 bg-white rounded border text-sm">
          <div class="flex items-center gap-2">
            <span class="px-2 py-1 text-xs rounded-full ${getSubjectColorClass(item.subject)}">${item.subject}</span>
            <span class="text-gray-600">${item.subSubject}</span>
            <span class="text-gray-500">${item.questionNumber}번</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-xs text-red-600">${item.wrongCount}회 오답</span>
            <span class="text-xs text-gray-500">${item.difficulty}급</span>
          </div>
        </div>
      `).join('');
    }

    // 변형문제 생성 함수
    function generateVariationProblems() {
      const generateBtn = document.getElementById('generateProblemsBtn');
      const preview = document.getElementById('generatedProblemsPreview');
      const problemsList = document.getElementById('generatedProblemsList');
      
      // 버튼 로딩 상태
      generateBtn.innerHTML = `
        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
        생성 중...
      `;
      generateBtn.disabled = true;
      
      // 3초 후 생성 완료 시뮬레이션
      setTimeout(() => {
        const problemCount = document.getElementById('problemCount').value;
        const difficulty = document.getElementById('difficultyLevel').value;
        const subject = document.getElementById('aiSubjectFilter').value;
        const variationType = document.getElementById('variationType').value;
        
        // 생성된 문제 목록 생성
        const generatedProblems = generateSampleProblems(problemCount, subject, difficulty, variationType);
        
        problemsList.innerHTML = generatedProblems.map((problem, index) => `
          <div class="flex items-start gap-3 p-3 bg-white rounded border">
            <span class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-800 text-xs font-bold rounded-full flex items-center justify-center">
              ${index + 1}
            </span>
            <div class="flex-1">
              <div class="text-sm font-medium mb-1">${problem.title}</div>
              <div class="text-xs text-gray-600 mb-2">${problem.description}</div>
              <div class="flex items-center gap-2">
                <span class="px-2 py-1 text-xs rounded-full ${getSubjectColorClass(problem.subject)}">${problem.subject}</span>
                <span class="text-xs text-gray-500">${problem.difficulty}급</span>
                <span class="text-xs text-gray-500">${problem.type}</span>
              </div>
            </div>
          </div>
        `).join('');
        
        // 미리보기 표시
        preview.classList.remove('hidden');
        
        // 버튼 원래 상태로 복원
        generateBtn.innerHTML = `
          <i data-lucide="zap" class="w-4 h-4"></i>
          변형문제 생성하기
        `;
        generateBtn.disabled = false;
        
        // 아이콘 다시 렌더링
        lucide.createIcons();
        
        // 스크롤을 미리보기로 이동
        preview.scrollIntoView({ behavior: 'smooth' });
        
      }, 3000);
    }

    // 샘플 변형문제 생성
    function generateSampleProblems(count, subject, difficulty, variationType) {
      const problems = [];
      const subjects = subject === 'all' ? ['수학', '국어', '영어', '과학탐구', '사회탐구', '한국사'] : [subject];
      
      for (let i = 0; i < count; i++) {
        const randomSubject = subjects[Math.floor(Math.random() * subjects.length)];
        problems.push({
          title: `${randomSubject} 변형문제 ${i + 1}`,
          description: `오답한 문제와 유사한 유형의 ${difficulty === 'mixed' ? '혼합' : difficulty} 난이도 문제입니다.`,
          subject: randomSubject,
          difficulty: difficulty === 'mixed' ? ['하', '중', '상'][Math.floor(Math.random() * 3)] : difficulty,
          type: variationType === 'mixed' ? ['유사', '개념', '응용'][Math.floor(Math.random() * 3)] : variationType
        });
      }
      
      return problems;
    }

    // 시험 선택 모달 관련
    const examModal = document.getElementById('examModal');
    const openExamModal = document.getElementById('openExamModal');
    const closeExam = document.getElementById('closeExam');
    const cancelExam = document.getElementById('cancelExam');
    const confirmExam = document.getElementById('confirmExam');
    const selectedExam = document.getElementById('selectedExam');
    const examYear = document.getElementById('examYear');
    const examMonth = document.getElementById('examMonth');
    const customAgency = document.getElementById('customAgency');
    const customSubject = document.getElementById('customSubject');
    const customSubjectCheck = document.getElementById('customSubjectCheck');

    // 정답 입력 모달 관련
    const answerModal = document.getElementById('answerModal');
    const openAnswerModal = document.getElementById('openAnswerModal');
    const closeAnswer = document.getElementById('closeAnswer');
    const cancelAnswer = document.getElementById('cancelAnswer');
    const confirmAnswer = document.getElementById('confirmAnswer');
    const answerInputContent = document.getElementById('answerInputContent');

    // 기존 정답 찾기 모달 관련
    const searchModal = document.getElementById('searchModal');
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    const emptyState = document.getElementById('emptyState');
    const openSearchModal = document.getElementById('openSearchModal');
    const closeSearch = document.getElementById('closeSearch');
    const cancelSearch = document.getElementById('cancelSearch');

    // 학년도 옵션 생성 (2010~2030)
    function populateYearOptions() {
      for (let year = 2030; year >= 2010; year--) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = `${year}학년도`;
        if (year === 2026) {
          option.selected = true; // 2026년을 기본 선택으로 설정
        }
        examYear.appendChild(option);
      }
    }

    // 시행월 옵션 생성 (1~12월)
    function populateMonthOptions() {
      const months = [
        { value: '1', text: '1월' },
        { value: '2', text: '2월' },
        { value: '3', text: '3월' },
        { value: '4', text: '4월' },
        { value: '5', text: '5월' },
        { value: '6', text: '6월' },
        { value: '7', text: '7월' },
        { value: '8', text: '8월' },
        { value: '9', text: '9월' },
        { value: '10', text: '10월' },
        { value: '11', text: '11월' },
        { value: '12', text: '12월' }
      ];
      
      months.forEach(month => {
        const option = document.createElement('option');
        option.value = month.value;
        option.textContent = month.text;
        examMonth.appendChild(option);
      });
    }

    // 정답 입력 폼 생성
    function generateAnswerInputForm() {
      const selectedSubject = getSelectedSubject();
      const selectedKoreanSubjects = getSelectedKoreanSubjects();
      const selectedMathSubjects = getSelectedMathSubjects();
      
      if (selectedSubject === 'korean') {
        if (selectedKoreanSubjects.length === 0) {
          // 국어 하위 과목이 선택되지 않은 경우
          answerInputContent.innerHTML = `
            <div class="text-center py-8">
              <p class="text-neutral-600">국어 하위 과목을 먼저 선택해주세요.</p>
              <p class="text-sm text-neutral-500 mt-2">화법과작문 또는 언어와매체를 선택하세요.</p>
            </div>
          `;
        } else {
          generateKoreanAnswerForm(selectedKoreanSubjects);
        }
      } else if (selectedSubject === 'math') {
        if (selectedMathSubjects.length === 0) {
          // 수학 하위 과목이 선택되지 않은 경우
          answerInputContent.innerHTML = `
            <div class="text-center py-8">
              <p class="text-neutral-600">수학 하위 과목을 먼저 선택해주세요.</p>
              <p class="text-sm text-neutral-500 mt-2">확률과통계, 미분과적분, 기하 중 하나를 선택하세요.</p>
            </div>
          `;
        } else {
          generateMathAnswerForm(selectedMathSubjects);
        }
      } else if (selectedSubject === 'english') {
        generateEnglishAnswerForm();
      } else if (selectedSubject === 'korean-history') {
        generateKoreanHistoryAnswerForm();
      } else if (selectedSubject === 'science') {
        const selectedScienceSubjects = getSelectedScienceSubjects();
        if (selectedScienceSubjects.length !== 2) {
          answerInputContent.innerHTML = `
            <div class="text-center py-8">
              <p class="text-neutral-600">과학탐구 과목을 2개 선택해주세요.</p>
              <p class="text-sm text-neutral-500 mt-2">현재 ${selectedScienceSubjects.length}개 선택됨</p>
            </div>
          `;
        } else {
          generateScienceAnswerForm(selectedScienceSubjects);
        }
      } else if (selectedSubject === 'social') {
        const selectedSocialSubjects = getSelectedSocialSubjects();
        if (selectedSocialSubjects.length !== 2) {
          answerInputContent.innerHTML = `
            <div class="text-center py-8">
              <p class="text-neutral-600">사회탐구 과목을 2개 선택해주세요.</p>
              <p class="text-sm text-neutral-500 mt-2">현재 ${selectedSocialSubjects.length}개 선택됨</p>
            </div>
          `;
        } else {
          generateSocialAnswerForm(selectedSocialSubjects);
        }
      } else if (selectedSubject === 'custom') {
        const customSubjectData = getCustomSubjectData();
        if (customSubjectData.subjectName && (customSubjectData.objectiveCount > 0 || customSubjectData.subjectiveCount > 0)) {
          generateCustomAnswerForm(customSubjectData);
        } else {
          answerInputContent.innerHTML = `
            <div class="text-center py-8">
              <p class="text-neutral-600">직접입력 과목의 정보를 입력해주세요.</p>
              <p class="text-sm text-neutral-500 mt-2">과목명과 문항 수를 선택하세요.</p>
            </div>
          `;
        }
      } else {
        // 다른 과목에 대한 기본 폼
        answerInputContent.innerHTML = `
          <div class="text-center py-8">
            <p class="text-neutral-600">${selectedSubject} 과목의 정답 입력 폼이 준비 중입니다.</p>
          </div>
        `;
      }
    }

    // 선택된 국어 하위 과목 가져오기
    function getSelectedKoreanSubjects() {
      const selectedSubjects = [];
      const koreanSubjects = document.querySelectorAll('input[name="koreanSubject"]:checked');
      koreanSubjects.forEach(input => {
        selectedSubjects.push(input.value);
      });
      return selectedSubjects;
    }

    // 선택된 수학 하위 과목 가져오기
    function getSelectedMathSubjects() {
      const selectedSubjects = [];
      const mathSubjects = document.querySelectorAll('input[name="mathSubject"]:checked');
      mathSubjects.forEach(input => {
        selectedSubjects.push(input.value);
      });
      return selectedSubjects;
    }

    // 선택된 과학탐구 과목 가져오기
    function getSelectedScienceSubjects() {
      const selectedSubjects = [];
      const scienceSubjects = document.querySelectorAll('input[name="scienceSubject"]:checked');
      scienceSubjects.forEach(input => {
        selectedSubjects.push(input.value);
      });
      return selectedSubjects;
    }

    // 선택된 사회탐구 과목 가져오기
    function getSelectedSocialSubjects() {
      const selectedSubjects = [];
      const socialSubjects = document.querySelectorAll('input[name="socialSubject"]:checked');
      socialSubjects.forEach(input => {
        selectedSubjects.push(input.value);
      });
      return selectedSubjects;
    }

    // 과목 선택 변경 처리
    function handleSubjectChange(subjectType) {
      // 모든 하위 과목 숨기기
      document.getElementById('koreanSubjects').classList.add('hidden');
      document.getElementById('mathSubjects').classList.add('hidden');
      document.getElementById('scienceSubjects').classList.add('hidden');
      document.getElementById('socialSubjects').classList.add('hidden');
      
      // 선택된 과목의 하위 과목만 표시
      if (subjectType === 'korean') {
        document.getElementById('koreanSubjects').classList.remove('hidden');
      } else if (subjectType === 'math') {
        document.getElementById('mathSubjects').classList.remove('hidden');
      } else if (subjectType === 'science') {
        document.getElementById('scienceSubjects').classList.remove('hidden');
      } else if (subjectType === 'social') {
        document.getElementById('socialSubjects').classList.remove('hidden');
      }
    }

    // 과학탐구 과목 선택 처리 (2과목 제한)
    function handleScienceSubjectChange() {
      const checkboxes = document.querySelectorAll('input[name="scienceSubject"]:checked');
      if (checkboxes.length > 2) {
        // 2개 초과 선택 시 마지막 선택 해제
        checkboxes[checkboxes.length - 1].checked = false;
      }
    }

    // 사회탐구 과목 선택 처리 (2과목 제한)
    function handleSocialSubjectChange() {
      const checkboxes = document.querySelectorAll('input[name="socialSubject"]:checked');
      if (checkboxes.length > 2) {
        // 2개 초과 선택 시 마지막 선택 해제
        checkboxes[checkboxes.length - 1].checked = false;
      }
    }

    // 직접입력 과목 처리
    function handleCustomSubjectChange() {
      const customCheckbox = document.getElementById('customSubjectCheck');
      const customForm = document.getElementById('customSubjectForm');
      
      if (customCheckbox.checked) {
        customForm.classList.remove('hidden');
        // 다른 과목 선택 해제
        document.querySelectorAll('input[name="subject"]').forEach(radio => {
          radio.checked = false;
        });
        document.querySelectorAll('input[name="koreanSubject"]').forEach(radio => {
          radio.checked = false;
        });
        document.querySelectorAll('input[name="mathSubject"]').forEach(radio => {
          radio.checked = false;
        });
        document.querySelectorAll('input[name="scienceSubject"]').forEach(checkbox => {
          checkbox.checked = false;
        });
        document.querySelectorAll('input[name="socialSubject"]').forEach(checkbox => {
          checkbox.checked = false;
        });
      } else {
        customForm.classList.add('hidden');
      }
    }

    // 선택된 과목 정보 가져오기
    function getSelectedSubject() {
      const customCheckbox = document.getElementById('customSubjectCheck');
      if (customCheckbox && customCheckbox.checked) {
        return 'custom';
      }
      
      const subjectRadios = document.querySelectorAll('input[name="subject"]');
      for (const radio of subjectRadios) {
        if (radio.checked) {
          return radio.value;
        }
      }
      return null;
    }

    // 직접입력 과목 데이터 가져오기
    function getCustomSubjectData() {
      const subjectName = document.getElementById('customSubject').value.trim();
      const objectiveCount = parseInt(document.getElementById('customObjectiveCount').value);
      const subjectiveCount = parseInt(document.getElementById('customSubjectiveCount').value);
      
      return {
        subjectName,
        objectiveCount,
        subjectiveCount
      };
    }

    // 국어 정답 입력 폼 생성
    function generateKoreanAnswerForm(selectedSubjects) {
      let html = `
        <div class="space-y-6">
          <div class="text-center">
            <h4 class="text-lg font-semibold">국어 ${getKoreanSubjectName(selectedSubjects)} 정답 입력</h4>
            <p class="text-sm text-neutral-600">총 45문제 (공통과목 1-34번, 선택과목 35-45번)</p>
          </div>
      `;

      // 공통과목 (1-34번) - 4열로 나누어 입력
      html += `
        <div class="space-y-4">
          <h5 class="text-md font-semibold text-blue-600">공통과목 (1-34번)</h5>
          <div class="grid grid-cols-4 gap-4">
      `;

      // 1-20번 (4개 그룹)
      for (let group = 0; group < 4; group++) {
        const start = group * 5 + 1;
        const end = start + 4;
        html += generateAnswerGroup(start, end, 'common');
      }

      // 21-34번 (3개 그룹)
      html += generateAnswerGroup(21, 25, 'common');
      html += generateAnswerGroup(26, 30, 'common');
      html += generateAnswerGroup(31, 34, 'common');

      html += `</div></div>`;

      // 선택과목 (35-45번) - 4열로 나누어 입력
      html += `
        <div class="space-y-4">
          <h5 class="text-md font-semibold text-green-600">선택과목 (35-45번)</h5>
          <div class="grid grid-cols-4 gap-4">
      `;

      // 35-45번 (3개 그룹)
      html += generateAnswerGroup(35, 39, 'elective');
      html += generateAnswerGroup(40, 44, 'elective');
      html += generateAnswerGroup(45, 45, 'elective');

      html += `</div></div>`;

      answerInputContent.innerHTML = html;
    }

    // 국어 하위 과목 이름 가져오기
    function getKoreanSubjectName(selectedSubjects) {
      const subjectNames = {
        'speech-writing': '화법과작문',
        'language-media': '언어와매체'
      };
      
      if (selectedSubjects.length === 1) {
        return subjectNames[selectedSubjects[0]] || '선택과목';
      } else if (selectedSubjects.length === 2) {
        return '화법과작문 + 언어와매체';
      } else {
        return '선택과목';
      }
    }

    // 영어 정답 입력 폼 생성
    function generateEnglishAnswerForm() {
      let html = `
        <div class="space-y-6">
          <div class="text-center">
            <h4 class="text-lg font-semibold">영어 정답 입력</h4>
            <p class="text-sm text-neutral-600">총 45문제 (5개씩 9그룹)</p>
          </div>
          
          <div class="space-y-4">
            <h5 class="text-md font-semibold text-blue-600">영어 (1-45번)</h5>
            <div class="grid grid-cols-5 gap-3">
      `;

      // 1-45번을 5개씩 9그룹으로 나누어 입력
      for (let group = 0; group < 9; group++) {
        const start = group * 5 + 1;
        const end = start + 4;
        html += generateEnglishAnswerGroup(start, end);
      }

      html += `</div></div>`;

      answerInputContent.innerHTML = html;
    }

    // 영어 정답 입력 그룹 생성 (5문제씩)
    function generateEnglishAnswerGroup(start, end) {
      const questionCount = end - start + 1;

      return `
        <div class="p-3 rounded-lg border-2 border-blue-200 bg-blue-50">
          <div class="text-center mb-2">
            <span class="text-sm font-medium text-neutral-600">${start}-${end}번</span>
          </div>
          <input 
            type="text" 
            class="w-full px-3 py-2 border border-neutral-300 rounded-md text-center font-mono text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="12345"
            maxlength="${questionCount}"
            pattern="[1-5]{${questionCount}}"
            oninput="validateEnglishAnswer(this)"
            onkeyup="autoTabNextEnglish(this, ${start}, ${end})"
            data-start="${start}"
            data-end="${end}"
            data-type="english"
          >
        </div>
      `;
    }

    // 영어 정답 유효성 검사
    function validateEnglishAnswer(input) {
      const value = input.value;
      const maxLength = parseInt(input.getAttribute('maxlength'));
      
      // 1-5 범위의 숫자만 허용
      const validPattern = new RegExp(`^[1-5]{0,${maxLength}}$`);
      
      if (!validPattern.test(value)) {
        input.value = value.replace(/[^1-5]/g, '');
      }
    }

    // 영어 정답 자동 탭 이동
    function autoTabNextEnglish(input, start, end) {
      const value = input.value;
      const maxLength = parseInt(input.getAttribute('maxlength'));
      
      if (value.length === maxLength) {
        // 다음 영어 입력 그룹 찾기
        const allEnglishInputs = document.querySelectorAll('input[data-type="english"]');
        let currentIndex = -1;
        
        allEnglishInputs.forEach((inp, index) => {
          if (inp === input) {
            currentIndex = index;
          }
        });
        
        if (currentIndex >= 0 && currentIndex < allEnglishInputs.length - 1) {
          const nextInput = allEnglishInputs[currentIndex + 1];
          nextInput.focus();
        }
      }
    }

    // 한국사 정답 입력 폼 생성
    function generateKoreanHistoryAnswerForm() {
      let html = `
        <div class="space-y-6">
          <div class="text-center">
            <h4 class="text-lg font-semibold">한국사 정답 입력</h4>
            <p class="text-sm text-neutral-600">총 20문제 (5개씩 4그룹)</p>
          </div>
          
          <div class="space-y-4">
            <h5 class="text-md font-semibold text-blue-600">한국사 (1-20번)</h5>
            <div class="grid grid-cols-5 gap-3">
      `;

      // 1-20번을 5개씩 4그룹으로 나누어 입력
      for (let group = 0; group < 4; group++) {
        const start = group * 5 + 1;
        const end = start + 4;
        html += generateKoreanHistoryAnswerGroup(start, end);
      }

      html += `</div></div>`;

      answerInputContent.innerHTML = html;
    }

    // 한국사 정답 입력 그룹 생성 (5문제씩)
    function generateKoreanHistoryAnswerGroup(start, end) {
      const questionCount = end - start + 1;

      return `
        <div class="p-3 rounded-lg border-2 border-blue-200 bg-blue-50">
          <div class="text-center mb-2">
            <span class="text-sm font-medium text-neutral-600">${start}-${end}번</span>
          </div>
          <input 
            type="text" 
            class="w-full px-3 py-2 border border-neutral-300 rounded-md text-center font-mono text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="12345"
            maxlength="${questionCount}"
            pattern="[1-5]{${questionCount}}"
            oninput="validateKoreanHistoryAnswer(this)"
            onkeyup="autoTabNextKoreanHistory(this, ${start}, ${end})"
            data-start="${start}"
            data-end="${end}"
            data-type="korean-history"
          >
        </div>
      `;
    }

    // 한국사 정답 유효성 검사
    function validateKoreanHistoryAnswer(input) {
      const value = input.value;
      const maxLength = parseInt(input.getAttribute('maxlength'));
      
      // 1-5 범위의 숫자만 허용
      const validPattern = new RegExp(`^[1-5]{0,${maxLength}}$`);
      
      if (!validPattern.test(value)) {
        input.value = value.replace(/[^1-5]/g, '');
      }
    }

    // 한국사 정답 자동 탭 이동
    function autoTabNextKoreanHistory(input, start, end) {
      const value = input.value;
      const maxLength = parseInt(input.getAttribute('maxlength'));
      
      if (value.length === maxLength) {
        // 다음 한국사 입력 그룹 찾기
        const allKoreanHistoryInputs = document.querySelectorAll('input[data-type="korean-history"]');
        let currentIndex = -1;
        
        allKoreanHistoryInputs.forEach((inp, index) => {
          if (inp === input) {
            currentIndex = index;
          }
        });
        
        if (currentIndex >= 0 && currentIndex < allKoreanHistoryInputs.length - 1) {
          const nextInput = allKoreanHistoryInputs[currentIndex + 1];
          nextInput.focus();
        }
      }
    }

    // 과학탐구 정답 입력 폼 생성
    function generateScienceAnswerForm(selectedSubjects) {
      const subjectNames = {
        'physics1': '물리1',
        'physics2': '물리2',
        'chemistry1': '화학1',
        'chemistry2': '화학2',
        'biology1': '생명과학1',
        'biology2': '생명과학2',
        'earth1': '지구과학1',
        'earth2': '지구과학2'
      };

      let html = `
        <div class="space-y-6">
          <div class="text-center">
            <h4 class="text-lg font-semibold">과학탐구 정답 입력</h4>
            <p class="text-sm text-neutral-600">총 40문제 (각 과목 20문제씩)</p>
          </div>
      `;

      // 첫 번째 과목
      html += `
        <div class="space-y-4">
          <h5 class="text-md font-semibold text-blue-600">${subjectNames[selectedSubjects[0]]} (1-20번)</h5>
          <div class="grid grid-cols-5 gap-3">
      `;

      for (let group = 0; group < 4; group++) {
        const start = group * 5 + 1;
        const end = start + 4;
        html += generateScienceAnswerGroup(start, end, selectedSubjects[0], 1);
      }

      html += `</div></div>`;

      // 두 번째 과목
      html += `
        <div class="space-y-4">
          <h5 class="text-md font-semibold text-green-600">${subjectNames[selectedSubjects[1]]} (21-40번)</h5>
          <div class="grid grid-cols-5 gap-3">
      `;

      for (let group = 0; group < 4; group++) {
        const start = group * 5 + 21;
        const end = start + 4;
        html += generateScienceAnswerGroup(start, end, selectedSubjects[1], 2);
      }

      html += `</div></div></div>`;

      answerInputContent.innerHTML = html;
    }

    // 사회탐구 정답 입력 폼 생성
    function generateSocialAnswerForm(selectedSubjects) {
      const subjectNames = {
        'social-culture': '사회문화',
        'ethics-ideology': '윤리와사상',
        'life-ethics': '생활과윤리',
        'korean-geography': '한국지리',
        'world-geography': '세계지리',
        'economics': '경제',
        'east-asian-history': '동아시아사',
        'world-history': '세계사',
        'politics-law': '정치와법'
      };

      let html = `
        <div class="space-y-6">
          <div class="text-center">
            <h4 class="text-lg font-semibold">사회탐구 정답 입력</h4>
            <p class="text-sm text-neutral-600">총 40문제 (각 과목 20문제씩)</p>
          </div>
      `;

      // 첫 번째 과목
      html += `
        <div class="space-y-4">
          <h5 class="text-md font-semibold text-blue-600">${subjectNames[selectedSubjects[0]]} (1-20번)</h5>
          <div class="grid grid-cols-5 gap-3">
      `;

      for (let group = 0; group < 4; group++) {
        const start = group * 5 + 1;
        const end = start + 4;
        html += generateSocialAnswerGroup(start, end, selectedSubjects[0], 1);
      }

      html += `</div></div>`;

      // 두 번째 과목
      html += `
        <div class="space-y-4">
          <h5 class="text-md font-semibold text-green-600">${subjectNames[selectedSubjects[1]]} (21-40번)</h5>
          <div class="grid grid-cols-5 gap-3">
      `;

      for (let group = 0; group < 4; group++) {
        const start = group * 5 + 21;
        const end = start + 4;
        html += generateSocialAnswerGroup(start, end, selectedSubjects[1], 2);
      }

      html += `</div></div></div>`;

      answerInputContent.innerHTML = html;
    }

    // 과학탐구 정답 입력 그룹 생성
    function generateScienceAnswerGroup(start, end, subject, subjectNumber) {
      const questionCount = end - start + 1;
      const groupClass = subjectNumber === 1 ? 'border-blue-200 bg-blue-50' : 'border-green-200 bg-green-50';

      return `
        <div class="p-3 rounded-lg border-2 ${groupClass}">
          <div class="text-center mb-2">
            <span class="text-sm font-medium text-neutral-600">${start}-${end}번</span>
          </div>
          <input 
            type="text" 
            class="w-full px-3 py-2 border border-neutral-300 rounded-md text-center font-mono text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="12345"
            maxlength="${questionCount}"
            pattern="[1-5]{${questionCount}}"
            oninput="validateScienceAnswer(this)"
            onkeyup="autoTabNextScience(this, ${start}, ${end})"
            data-start="${start}"
            data-end="${end}"
            data-type="science"
            data-subject="${subject}"
          >
        </div>
      `;
    }

    // 사회탐구 정답 입력 그룹 생성
    function generateSocialAnswerGroup(start, end, subject, subjectNumber) {
      const questionCount = end - start + 1;
      const groupClass = subjectNumber === 1 ? 'border-blue-200 bg-blue-50' : 'border-green-200 bg-green-50';

      return `
        <div class="p-3 rounded-lg border-2 ${groupClass}">
          <div class="text-center mb-2">
            <span class="text-sm font-medium text-neutral-600">${start}-${end}번</span>
          </div>
          <input 
            type="text" 
            class="w-full px-3 py-2 border border-neutral-300 rounded-md text-center font-mono text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="12345"
            maxlength="${questionCount}"
            pattern="[1-5]{${questionCount}}"
            oninput="validateSocialAnswer(this)"
            onkeyup="autoTabNextSocial(this, ${start}, ${end})"
            data-start="${start}"
            data-end="${end}"
            data-type="social"
            data-subject="${subject}"
          >
        </div>
      `;
    }

    // 과학탐구 정답 유효성 검사
    function validateScienceAnswer(input) {
      const value = input.value;
      const maxLength = parseInt(input.getAttribute('maxlength'));
      
      const validPattern = new RegExp(`^[1-5]{0,${maxLength}}$`);
      
      if (!validPattern.test(value)) {
        input.value = value.replace(/[^1-5]/g, '');
      }
    }

    // 사회탐구 정답 유효성 검사
    function validateSocialAnswer(input) {
      const value = input.value;
      const maxLength = parseInt(input.getAttribute('maxlength'));
      
      const validPattern = new RegExp(`^[1-5]{0,${maxLength}}$`);
      
      if (!validPattern.test(value)) {
        input.value = value.replace(/[^1-5]/g, '');
      }
    }

    // 과학탐구 정답 자동 탭 이동
    function autoTabNextScience(input, start, end) {
      const value = input.value;
      const maxLength = parseInt(input.getAttribute('maxlength'));
      
      if (value.length === maxLength) {
        const allScienceInputs = document.querySelectorAll('input[data-type="science"]');
        let currentIndex = -1;
        
        allScienceInputs.forEach((inp, index) => {
          if (inp === input) {
            currentIndex = index;
          }
        });
        
        if (currentIndex >= 0 && currentIndex < allScienceInputs.length - 1) {
          const nextInput = allScienceInputs[currentIndex + 1];
          nextInput.focus();
        }
      }
    }

    // 사회탐구 정답 자동 탭 이동
    function autoTabNextSocial(input, start, end) {
      const value = input.value;
      const maxLength = parseInt(input.getAttribute('maxlength'));
      
      if (value.length === maxLength) {
        const allSocialInputs = document.querySelectorAll('input[data-type="social"]');
        let currentIndex = -1;
        
        allSocialInputs.forEach((inp, index) => {
          if (inp === input) {
            currentIndex = index;
          }
        });
        
        if (currentIndex >= 0 && currentIndex < allSocialInputs.length - 1) {
          const nextInput = allSocialInputs[currentIndex + 1];
          nextInput.focus();
        }
      }
    }

    // 직접입력 과목 정답 입력 폼 생성
    function generateCustomAnswerForm(customData) {
      const { subjectName, objectiveCount, subjectiveCount } = customData;
      let html = `
        <div class="space-y-6">
          <div class="text-center">
            <h4 class="text-lg font-semibold">${subjectName} 정답 입력</h4>
            <p class="text-sm text-neutral-600">총 ${objectiveCount + subjectiveCount}문제 (객관식 ${objectiveCount}문항, 주관식 ${subjectiveCount}문항)</p>
          </div>
      `;

      // 객관식 문항이 있는 경우
      if (objectiveCount > 0) {
        html += `
          <div class="space-y-4">
            <h5 class="text-md font-semibold text-blue-600">객관식 (1-${objectiveCount}번)</h5>
            <div class="grid grid-cols-5 gap-3">
        `;

        // 객관식을 5개씩 그룹으로 나누어 입력
        for (let group = 0; group < Math.ceil(objectiveCount / 5); group++) {
          const start = group * 5 + 1;
          const end = Math.min(start + 4, objectiveCount);
          html += generateCustomAnswerGroup(start, end, 'objective');
        }

        html += `</div></div>`;
      }

      // 주관식 문항이 있는 경우
      if (subjectiveCount > 0) {
        const startNum = objectiveCount + 1;
        html += `
          <div class="space-y-4">
            <h5 class="text-md font-semibold text-green-600">주관식 (${startNum}-${objectiveCount + subjectiveCount}번)</h5>
            <div class="grid grid-cols-5 gap-3">
        `;

        // 주관식을 개별 입력으로 생성
        for (let i = 0; i < subjectiveCount; i++) {
          const questionNum = startNum + i;
          html += generateCustomSubjectiveInput(questionNum);
        }

        html += `</div></div>`;
      }

      html += `</div>`;

      answerInputContent.innerHTML = html;
    }

    // 직접입력 과목 정답 입력 그룹 생성 (객관식용)
    function generateCustomAnswerGroup(start, end, type) {
      const questionCount = end - start + 1;
      const groupClass = type === 'objective' ? 'border-blue-200 bg-blue-50' : 'border-green-200 bg-green-50';

      return `
        <div class="p-3 rounded-lg border-2 ${groupClass}">
          <div class="text-center mb-2">
            <span class="text-sm font-medium text-neutral-600">${start}-${end}번</span>
          </div>
          <input 
            type="text" 
            class="w-full px-3 py-2 border border-neutral-300 rounded-md text-center font-mono text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="12345"
            maxlength="${questionCount}"
            pattern="[1-5]{${questionCount}}"
            oninput="validateCustomAnswer(this)"
            onkeyup="autoTabNextCustom(this, ${start}, ${end})"
            data-start="${start}"
            data-end="${end}"
            data-type="custom"
            data-question-type="${type}"
          >
        </div>
      `;
    }

    // 직접입력 과목 주관식 개별 입력 생성
    function generateCustomSubjectiveInput(questionNum) {
      return `
        <div class="p-3 rounded-lg border-2 border-green-200 bg-green-50">
          <div class="text-center mb-2">
            <span class="text-sm font-medium text-neutral-600">${questionNum}번</span>
          </div>
          <input 
            type="text" 
            class="w-full px-3 py-2 border border-neutral-300 rounded-md text-center font-mono text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="답안 입력"
            data-question="${questionNum}"
            data-type="custom"
            data-question-type="subjective"
          >
        </div>
      `;
    }

    // 직접입력 과목 정답 유효성 검사
    function validateCustomAnswer(input) {
      const value = input.value;
      const maxLength = parseInt(input.getAttribute('maxlength'));
      
      const validPattern = new RegExp(`^[1-5]{0,${maxLength}}$`);
      
      if (!validPattern.test(value)) {
        input.value = value.replace(/[^1-5]/g, '');
      }
    }

    // 직접입력 과목 정답 자동 탭 이동
    function autoTabNextCustom(input, start, end) {
      const value = input.value;
      const maxLength = parseInt(input.getAttribute('maxlength'));
      
      if (value.length === maxLength) {
        const allCustomInputs = document.querySelectorAll('input[data-type="custom"]');
        let currentIndex = -1;
        
        allCustomInputs.forEach((inp, index) => {
          if (inp === input) {
            currentIndex = index;
          }
        });
        
        if (currentIndex >= 0 && currentIndex < allCustomInputs.length - 1) {
          const nextInput = allCustomInputs[currentIndex + 1];
          nextInput.focus();
        }
      }
    }

    // 수학 정답 입력 폼 생성
    function generateMathAnswerForm(selectedSubjects) {
      let html = `
        <div class="space-y-6">
          <div class="text-center">
            <h4 class="text-lg font-semibold">수학 ${getMathSubjectName(selectedSubjects)} 정답 입력</h4>
            <p class="text-sm text-neutral-600">총 30문제 (공통과목 1-22번, 선택과목 23-30번)</p>
          </div>
      `;

      // 공통과목 (1-22번)
      html += `
        <div class="space-y-4">
          <h5 class="text-md font-semibold text-blue-600">공통과목 (1-22번)</h5>
          
          <!-- 객관식 (1-15번) -->
          <div class="space-y-3">
            <h6 class="text-sm font-medium text-blue-500">객관식 (1-15번)</h6>
            <div class="grid grid-cols-5 gap-3">
      `;

      // 1-15번 객관식 (3개 그룹)
      for (let group = 0; group < 3; group++) {
        const start = group * 5 + 1;
        const end = start + 4;
        html += generateMathAnswerGroup(start, end, 'common', 'objective');
      }

      html += `</div></div>`;

      // 주관식 (16-22번)
      html += `
        <div class="space-y-3">
          <h6 class="text-sm font-medium text-blue-500">주관식 (16-22번)</h6>
          <div class="grid grid-cols-7 gap-2">
      `;

      // 16-22번 주관식 (개별 입력)
      for (let i = 16; i <= 22; i++) {
        html += generateMathSubjectiveInput(i, 'common');
      }

      html += `</div></div></div>`;

      // 선택과목 (23-30번)
      html += `
        <div class="space-y-4">
          <h5 class="text-md font-semibold text-green-600">선택과목 (23-30번)</h5>
          
          <!-- 객관식 (23-30번) -->
          <div class="space-y-3">
            <h6 class="text-sm font-medium text-green-500">객관식 (23-30번)</h6>
            <div class="grid grid-cols-5 gap-3">
      `;

      // 23-30번 객관식 (2개 그룹)
      html += generateMathAnswerGroup(23, 27, 'elective', 'objective');
      html += generateMathAnswerGroup(28, 28, 'elective', 'objective');

      html += `</div></div>`;

      // 주관식 (29-30번)
      html += `
        <div class="space-y-3">
          <h6 class="text-sm font-medium text-green-500">주관식 (29-30번)</h6>
          <div class="grid grid-cols-7 gap-2">
      `;

      // 29-30번 주관식 (개별 입력)
      for (let i = 29; i <= 30; i++) {
        html += generateMathSubjectiveInput(i, 'elective');
      }

      html += `</div></div></div>`;

      answerInputContent.innerHTML = html;
    }

    // 수학 하위 과목 이름 가져오기
    function getMathSubjectName(selectedSubjects) {
      const subjectNames = {
        'probability-statistics': '확률과통계',
        'calculus': '미분과적분',
        'geometry': '기하'
      };
      
      if (selectedSubjects.length === 1) {
        return subjectNames[selectedSubjects[0]] || '선택과목';
      } else if (selectedSubjects.length === 2) {
        const names = selectedSubjects.map(s => subjectNames[s]).filter(Boolean);
        return names.join(' + ');
      } else if (selectedSubjects.length === 3) {
        return '확률과통계 + 미분과적분 + 기하';
      } else {
        return '선택과목';
      }
    }

    // 수학 정답 입력 그룹 생성 (객관식 5문제씩)
    function generateMathAnswerGroup(start, end, type, questionType) {
      const groupClass = type === 'common' ? 'border-blue-200 bg-blue-50' : 'border-green-200 bg-green-50';
      const questionCount = end - start + 1;

      return `
        <div class="p-3 rounded-lg border-2 ${groupClass}">
          <div class="text-center mb-2">
            <span class="text-sm font-medium text-neutral-600">${start}-${end}번</span>
          </div>
          <input 
            type="text" 
            class="w-full px-3 py-2 border border-neutral-300 rounded-md text-center font-mono text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="12345"
            maxlength="${questionCount}"
            pattern="[1-5]{${questionCount}}"
            oninput="validateMathAnswer(this)"
            onkeyup="autoTabNextMath(this, ${start}, ${end})"
            data-start="${start}"
            data-end="${end}"
            data-type="${type}"
            data-question-type="${questionType}"
          >
        </div>
      `;
    }

    // 수학 주관식 개별 입력 생성
    function generateMathSubjectiveInput(questionNum, type) {
      const groupClass = type === 'common' ? 'border-blue-200 bg-blue-50' : 'border-green-200 bg-green-50';
      
      return `
        <div class="p-2 rounded-lg border-2 ${groupClass}">
          <div class="text-center mb-1">
            <span class="text-xs font-medium text-neutral-600">${questionNum}번</span>
          </div>
          <input 
            type="text" 
            class="w-full px-2 py-1 border border-neutral-300 rounded-md text-center font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="답안"
            data-question="${questionNum}"
            data-type="${type}"
            data-question-type="subjective"
          >
        </div>
      `;
    }

    // 수학 정답 유효성 검사
    function validateMathAnswer(input) {
      const value = input.value;
      const maxLength = parseInt(input.getAttribute('maxlength'));
      const pattern = input.getAttribute('pattern');
      
      // 1-5 범위의 숫자만 허용
      const validPattern = new RegExp(`^[1-5]{0,${maxLength}}$`);
      
      if (!validPattern.test(value)) {
        input.value = value.replace(/[^1-5]/g, '');
      }
    }

    // 수학 정답 자동 탭 이동
    function autoTabNextMath(input, start, end) {
      const value = input.value;
      const maxLength = parseInt(input.getAttribute('maxlength'));
      
      if (value.length === maxLength) {
        // 다음 객관식 그룹 찾기
        const allGroupInputs = document.querySelectorAll('input[data-start]');
        let currentIndex = -1;
        
        allGroupInputs.forEach((inp, index) => {
          if (inp === input) {
            currentIndex = index;
          }
        });
        
        if (currentIndex >= 0 && currentIndex < allGroupInputs.length - 1) {
          const nextInput = allGroupInputs[currentIndex + 1];
          nextInput.focus();
        }
      }
    }

    // 정답 입력 그룹 생성 (5문제씩)
    function generateAnswerGroup(start, end, type) {
      const groupClass = type === 'common' ? 'border-blue-200 bg-blue-50' : 'border-green-200 bg-green-50';
      const questionCount = end - start + 1;
      
      let html = `
        <div class="rounded-xl border-2 ${groupClass} p-4">
          <div class="mb-3">
            <label class="block text-sm font-medium mb-2">${start}번~${end}번 (${questionCount}문제)</label>
            <input type="text" 
                   class="w-full rounded-lg border px-3 py-2 text-lg font-mono text-center" 
                   name="answer_group_${start}_${end}"
                   placeholder="${'1'.repeat(questionCount)}"
                   maxlength="${questionCount}"
                   pattern="[1-5]{${questionCount}}"
                   title="1-5 숫자만 입력하세요 (${questionCount}자리)"
                   oninput="this.value = this.value.replace(/[^1-5]/g, '')"
                   onkeyup="autoTabNext(this, ${start}, ${end})"
            />
          </div>
          <div class="grid grid-cols-5 gap-2 text-xs text-center">
      `;

      for (let i = start; i <= end; i++) {
        html += `<div class="font-medium">${i}번</div>`;
      }

      html += `</div></div>`;
      return html;
    }

    // 자동 탭 기능 (5문제 입력 완료 시 다음 그룹으로 이동)
    function autoTabNext(input, start, end) {
      const expectedLength = end - start + 1;
      if (input.value.length === expectedLength) {
        // 현재 입력 필드의 다음 입력 필드 찾기
        const allInputs = Array.from(answerInputContent.querySelectorAll('input[type="text"]'));
        const currentIndex = allInputs.indexOf(input);
        const nextInput = allInputs[currentIndex + 1];
        
        if (nextInput) {
          nextInput.focus();
        }
      }
    }

    // 평가기관 직접입력 토글
    function toggleCustomAgency() {
      const customRadio = document.querySelector('input[name="examAgency"][value="custom"]');
      if (customRadio.checked) {
        customAgency.classList.remove('hidden');
        customAgency.required = true;
      } else {
        customAgency.classList.add('hidden');
        customAgency.required = false;
        customAgency.value = '';
      }
    }

    // 과목 직접입력 토글
    function toggleCustomSubject() {
      if (customSubjectCheck.checked) {
        customSubject.classList.remove('hidden');
        customSubject.required = true;
        // 다른 과목 선택 해제
        document.querySelectorAll('.subject-radio').forEach(radio => radio.checked = false);
        document.getElementById('scienceSubjects').classList.add('hidden');
        document.getElementById('socialSubjects').classList.add('hidden');
      } else {
        customSubject.classList.add('hidden');
        customSubject.required = false;
        customSubject.value = '';
      }
    }

    // 과목별 하위 과목 토글
    function toggleSubjectDetails() {
      const koreanRadio = document.getElementById('koreanRadio');
      const mathRadio = document.getElementById('mathRadio');
      const scienceRadio = document.getElementById('scienceRadio');
      const socialRadio = document.getElementById('socialRadio');
      
      const koreanSubjects = document.getElementById('koreanSubjects');
      const mathSubjects = document.getElementById('mathSubjects');
      const scienceSubjects = document.getElementById('scienceSubjects');
      const socialSubjects = document.getElementById('socialSubjects');

      // 모든 하위 과목 숨기기
      koreanSubjects.classList.add('hidden');
      mathSubjects.classList.add('hidden');
      scienceSubjects.classList.add('hidden');
      socialSubjects.classList.add('hidden');

      if (koreanRadio.checked) {
        koreanSubjects.classList.remove('hidden');
        customSubjectCheck.checked = false;
        customSubject.classList.add('hidden');
      } else if (mathRadio.checked) {
        mathSubjects.classList.remove('hidden');
        customSubjectCheck.checked = false;
        customSubject.classList.add('hidden');
      } else if (scienceRadio.checked) {
        scienceSubjects.classList.remove('hidden');
        customSubjectCheck.checked = false;
        customSubject.classList.add('hidden');
      } else if (socialRadio.checked) {
        socialSubjects.classList.remove('hidden');
        customSubjectCheck.checked = false;
        customSubject.classList.add('hidden');
      }
    }

    // 선택된 시험 정보 업데이트
    function updateSelectedExam() {
      const year = examYear.value;
      const month = examMonth.value;
      const agencyRadios = document.querySelectorAll('input[name="examAgency"]');
      const subjectRadios = document.querySelectorAll('input[name="subject"]');
      
      let agency = '';
      let subject = '';

      // 평가기관 선택
      for (const radio of agencyRadios) {
        if (radio.checked) {
          if (radio.value === 'custom') {
            agency = customAgency.value || '직접입력';
          } else {
            const labels = {
              'evaluation': '평가원',
              'education': '교육청',
              'sidaein': '시대인재',
              'megastudy': '메가스터디'
            };
            agency = labels[radio.value] || radio.value;
          }
          break;
        }
      }

      // 과목 선택
      if (customSubjectCheck.checked) {
        subject = customSubject.value || '직접입력';
      } else {
        for (const radio of subjectRadios) {
          if (radio.checked) {
            if (radio.value === 'korean') {
              const selectedKorean = Array.from(document.querySelectorAll('input[name="koreanSubject"]:checked'))
                .map(cb => cb.nextElementSibling.textContent).join(', ');
              subject = selectedKorean || '국어';
            } else if (radio.value === 'math') {
              const selectedMath = Array.from(document.querySelectorAll('input[name="mathSubject"]:checked'))
                .map(cb => cb.nextElementSibling.textContent).join(', ');
              subject = selectedMath || '수학';
            } else if (radio.value === 'science') {
              const selectedScience = Array.from(document.querySelectorAll('input[name="scienceSubject"]:checked'))
                .map(cb => cb.nextElementSibling.textContent).join(', ');
              subject = selectedScience || '과학탐구';
            } else if (radio.value === 'social') {
              const selectedSocial = Array.from(document.querySelectorAll('input[name="socialSubject"]:checked'))
                .map(cb => cb.nextElementSibling.textContent).join(', ');
              subject = selectedSocial || '사회탐구';
            } else {
              const labels = {
                'english': '영어',
                'korean-history': '한국사'
              };
              subject = labels[radio.value] || radio.value;
            }
            break;
          }
        }
      }

      if (year && agency && subject) {
        const monthText = month ? `${month}월 ` : '';
        selectedExam.textContent = `${year} ${monthText}${agency} (${subject})`;
        
        // 문항별 결과 예시 업데이트
        updateQuestionResults(subject);
      } else {
        selectedExam.textContent = '시험을 선택하세요';
        // 기본 예시 표시
        generateQuestionResults('default');
      }
    }

    // 이벤트 리스너 등록
    openExamModal.addEventListener('click', () => {
      examModal.classList.add('open');
      populateYearOptions();
      populateMonthOptions();
    });

    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', () => {
      // 초기 문항별 결과 예시 표시 (수학 샘플)
      generateQuestionResults('수학');
    });

    closeExam.addEventListener('click', () => examModal.classList.remove('open'));
    cancelExam.addEventListener('click', () => examModal.classList.remove('open'));
    examModal.addEventListener('click', (e) => {
      if (e.target === examModal) examModal.classList.remove('open');
    });

    // 평가기관 변경 이벤트
    document.querySelectorAll('input[name="examAgency"]').forEach(radio => {
      radio.addEventListener('change', () => {
        toggleCustomAgency();
        updateSelectedExam();
      });
    });

    // 과목 변경 이벤트
    document.querySelectorAll('input[name="subject"]').forEach(radio => {
      radio.addEventListener('change', () => {
        toggleSubjectDetails();
        updateSelectedExam();
      });
    });

    // 직접입력 체크박스 이벤트
    customSubjectCheck.addEventListener('change', () => {
      toggleCustomSubject();
      updateSelectedExam();
    });

    // 직접입력 필드 이벤트
    customAgency.addEventListener('input', updateSelectedExam);
    customSubject.addEventListener('input', updateSelectedExam);

    // 학년도 변경 이벤트
    examYear.addEventListener('change', updateSelectedExam);

    // 시행월 변경 이벤트
    examMonth.addEventListener('change', updateSelectedExam);

    // 확인 버튼 이벤트
    confirmExam.addEventListener('click', () => {
      updateSelectedExam();
      examModal.classList.remove('open');
    });

    // 정답 입력 모달 이벤트
    openAnswerModal.addEventListener('click', () => {
      const selectedSubject = getSelectedSubject();
      
      if (!selectedSubject) {
        // 시험 선택이 안된 경우
        answerInputContent.innerHTML = `
          <div class="text-center py-8">
            <div class="mb-4">
              <div class="w-16 h-16 mx-auto mb-4 bg-yellow-100 rounded-full flex items-center justify-center">
                <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
              </div>
              <h3 class="text-lg font-semibold text-neutral-800 mb-2">시험을 먼저 선택해주세요</h3>
              <p class="text-neutral-600">시험을 먼저 지정해주신 후 정답을 입력해 주세요.</p>
            </div>
            <button onclick="openExamModal()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
              시험 선택하기
            </button>
          </div>
        `;
      } else {
        generateAnswerInputForm();
      }
      
      answerModal.classList.add('open');
    });

    closeAnswer.addEventListener('click', () => answerModal.classList.remove('open'));
    cancelAnswer.addEventListener('click', () => answerModal.classList.remove('open'));
    answerModal.addEventListener('click', (e) => {
      if (e.target === answerModal) answerModal.classList.remove('open');
    });

    // 정답 확인 버튼 이벤트
    confirmAnswer.addEventListener('click', () => {
      const answers = collectAnswers();
      console.log('입력된 정답:', answers);
      answerModal.classList.remove('open');
      // 여기에 정답 저장 로직 추가
    });

    // 기존 정답 찾기 모달 이벤트
    openSearchModal.addEventListener('click', () => {
      searchModal.classList.add('open');
      loadSavedAnswers();
    });

    closeSearch.addEventListener('click', () => searchModal.classList.remove('open'));
    cancelSearch.addEventListener('click', () => searchModal.classList.remove('open'));
    searchModal.addEventListener('click', (e) => {
      if (e.target === searchModal) searchModal.classList.remove('open');
    });

    // 검색 기능
    searchInput.addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      searchAnswers(query);
    });

    // 정답 수집 함수
    function collectAnswers() {
      const answers = {};
      
      // 국어/수학/영어/직접입력 그룹 입력 (객관식)
      const groupInputs = answerInputContent.querySelectorAll('input[data-start]');
      groupInputs.forEach(input => {
        const start = parseInt(input.getAttribute('data-start'));
        const end = parseInt(input.getAttribute('data-end'));
        const value = input.value;
        
        if (value && value.length === (end - start + 1)) {
          for (let i = 0; i < value.length; i++) {
            const questionNum = start + i;
            answers[questionNum] = value[i];
          }
        }
      });
      
      // 수학/직접입력 주관식 개별 입력
      const subjectiveInputs = answerInputContent.querySelectorAll('input[data-question]');
      subjectiveInputs.forEach(input => {
        const questionNum = parseInt(input.getAttribute('data-question'));
        const value = input.value.trim();
        
        if (value) {
          answers[questionNum] = value;
        }
      });
      
      return answers;
    }

    // 저장된 정답 데이터 (실제로는 DB에서 가져와야 함)
    let savedAnswers = [
      {
        id: 1,
        examYear: 2026,
        examMonth: 6,
        agency: '평가원',
        subject: '국어',
        subSubject: '화법과작문',
        totalQuestions: 45,
        answers: {1: '2', 2: '3', 3: '1', 4: '4', 5: '2'},
        createdAt: '2024-01-15T10:30:00Z'
      },
      {
        id: 2,
        examYear: 2026,
        examMonth: 6,
        agency: '평가원',
        subject: '수학',
        subSubject: '확률과통계',
        totalQuestions: 30,
        answers: {1: '3', 2: '1', 3: '4', 4: '2', 5: '1'},
        createdAt: '2024-01-15T11:15:00Z'
      },
      {
        id: 3,
        examYear: 2026,
        examMonth: 6,
        agency: '교육청',
        subject: '영어',
        subSubject: null,
        totalQuestions: 45,
        answers: {1: '2', 2: '4', 3: '1', 4: '3', 5: '2'},
        createdAt: '2024-01-15T14:20:00Z'
      },
      {
        id: 4,
        examYear: 2025,
        examMonth: 11,
        agency: '시대인재',
        subject: '과학탐구',
        subSubject: '물리1, 화학1',
        totalQuestions: 40,
        answers: {1: '3', 2: '1', 3: '4', 4: '2', 5: '1'},
        createdAt: '2024-01-10T09:45:00Z'
      }
    ];

    // 저장된 정답 로드
    function loadSavedAnswers() {
      displaySearchResults(savedAnswers);
    }

    // 검색 기능
    function searchAnswers(query) {
      if (!query.trim()) {
        displaySearchResults(savedAnswers);
        return;
      }

      const filteredResults = savedAnswers.filter(answer => {
        const searchText = `${answer.examYear} ${answer.examMonth} ${answer.agency} ${answer.subject} ${answer.subSubject || ''}`.toLowerCase();
        return searchText.includes(query);
      });

      displaySearchResults(filteredResults);
    }

    // 검색 결과 표시
    function displaySearchResults(results) {
      if (results.length === 0) {
        searchResults.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }

      emptyState.classList.add('hidden');
      
      const resultsHTML = results.map(answer => `
        <div class="p-4 border border-neutral-200 rounded-lg hover:bg-neutral-50 cursor-pointer transition-colors" 
             onclick="selectAnswer(${answer.id})">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-2">
              <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${answer.examYear}년</span>
              <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">${answer.examMonth}월</span>
              <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">${answer.agency}</span>
            </div>
            <span class="text-xs text-neutral-500">${formatDate(answer.createdAt)}</span>
          </div>
          <div class="mb-2">
            <h4 class="font-semibold text-neutral-800">${answer.subject}${answer.subSubject ? ` (${answer.subSubject})` : ''}</h4>
            <p class="text-sm text-neutral-600">총 ${answer.totalQuestions}문제</p>
          </div>
          <div class="flex items-center gap-2 text-sm text-neutral-500">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <span>클릭하여 선택</span>
          </div>
        </div>
      `).join('');

      searchResults.innerHTML = resultsHTML;
    }

    // 정답 선택
    function selectAnswer(answerId) {
      const selectedAnswer = savedAnswers.find(answer => answer.id === answerId);
      if (selectedAnswer) {
        // 선택된 정답을 현재 시험 선택에 적용
        applySelectedAnswer(selectedAnswer);
        searchModal.classList.remove('open');
      }
    }

    // 선택된 정답 적용
    function applySelectedAnswer(answer) {
      // 시험 선택 정보 업데이트
      examYear.value = answer.examYear;
      examMonth.value = answer.examMonth;
      
      // 평가기관 설정
      if (answer.agency === '직접입력') {
        customAgencyCheck.checked = true;
        customAgency.value = answer.agency;
        customAgency.classList.remove('hidden');
      } else {
        const agencyRadio = document.querySelector(`input[name="agency"][value="${answer.agency}"]`);
        if (agencyRadio) {
          agencyRadio.checked = true;
        }
      }

      // 과목 설정
      if (answer.subject === '직접입력') {
        customSubjectCheck.checked = true;
        customSubject.value = answer.subject;
        customSubject.classList.remove('hidden');
      } else {
        const subjectRadio = document.querySelector(`input[name="subject"][value="${answer.subject}"]`);
        if (subjectRadio) {
          subjectRadio.checked = true;
          handleSubjectChange(answer.subject);
        }
      }

      // 하위 과목 설정
      if (answer.subSubject) {
        const subSubjects = answer.subSubject.split(', ');
        subSubjects.forEach(sub => {
          const subRadio = document.querySelector(`input[name="${answer.subject}Subject"][value="${sub}"]`);
          if (subRadio) {
            subRadio.checked = true;
          }
        });
      }

      updateSelectedExam();
    }

    // 날짜 포맷팅
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // 답안지 검색 기능
    function searchAnswers() {
      const nameSearch = document.getElementById('nameSearch');
      const studentIdSearch = document.getElementById('studentIdSearch');
      
      if (!nameSearch || !studentIdSearch) return;
      
      const name = nameSearch.value.trim();
      const studentId = studentIdSearch.value.trim();
      
      if (!name && !studentId) {
        alert('이름 또는 학번을 입력해주세요.');
        return;
      }
      
      // 실제로는 서버에서 검색해야 하지만, 여기서는 시뮬레이션
      console.log('검색 조건:', { name, studentId });
      
      // 검색 결과 표시 (시뮬레이션)
      const searchResults = document.getElementById('searchResults');
      if (searchResults) {
        searchResults.innerHTML = `
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <h4 class="font-semibold text-blue-800 mb-2">검색 결과</h4>
            <p class="text-sm text-blue-700">
              ${name ? `이름: ${name}` : ''} ${studentId ? `학번: ${studentId}` : ''}에 대한 답안지를 찾았습니다.
            </p>
          </div>
        `;
      }
    }

    // 검색 초기화
    function clearSearch() {
      const nameSearch = document.getElementById('nameSearch');
      const studentIdSearch = document.getElementById('studentIdSearch');
      
      if (nameSearch) nameSearch.value = '';
      if (studentIdSearch) studentIdSearch.value = '';
      
      const searchResults = document.getElementById('searchResults');
      if (searchResults) {
        searchResults.innerHTML = '';
      }
    }

    // 문항별 결과 예시 생성
    function generateQuestionResults(subject) {
      const questionResults = document.getElementById('questionResults');
      if (!questionResults) return;

      let results = [];
      
      switch(subject) {
        case '국어':
          results = generateKoreanResults();
          break;
        case '수학':
          results = generateMathResults();
          break;
        case '영어':
          results = generateEnglishResults();
          break;
        case '한국사':
          results = generateKoreanHistoryResults();
          break;
        case '과학탐구':
          results = generateScienceResults();
          break;
        case '사회탐구':
          results = generateSocialResults();
          break;
        default:
          results = generateDefaultResults();
      }

      // 수학인 경우 구분된 레이아웃으로 표시
      if (subject === '수학') {
        questionResults.innerHTML = generateMathLayout(results);
      } else {
        questionResults.innerHTML = `
          <div class="space-y-4">
            <!-- 검색 기능 -->
            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 mb-4">
              <h3 class="text-lg font-semibold text-gray-800 mb-3">🔍 답안지 검색</h3>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">이름 검색</label>
                  <input type="text" id="nameSearch" placeholder="학생 이름을 입력하세요" 
                         class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">학번 검색</label>
                  <input type="text" id="studentIdSearch" placeholder="학번을 입력하세요" 
                         class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
              </div>
              <div class="mt-3 flex gap-2">
                <button onclick="searchAnswers()" class="px-4 py-2 text-sm font-medium bg-blue-600 text-white rounded-lg hover:bg-blue-700">검색</button>
                <button onclick="clearSearch()" class="px-4 py-2 text-sm font-medium border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">초기화</button>
              </div>
            </div>
            
            <!-- 문항별 결과 -->
            <div class="grid grid-cols-8 gap-2">
              ${results.map(result => 
                `<div class='rounded-lg px-3 py-2 text-center text-sm font-medium ${result.isCorrect ? 'bg-green-100 text-green-800 border border-green-300' : 'bg-red-100 text-red-800 border border-red-300'}'>${result.question}번 ${result.isCorrect ? '정답' : '오답'}</div>`
              ).join('')}
            </div>
          </div>
        `;
      }
    }

    // 국어 결과 생성 (45문제)
    function generateKoreanResults() {
      const results = [];
      for (let i = 1; i <= 45; i++) {
        // 공통과목(1-34)과 선택과목(35-45)에 따라 다른 패턴
        const isCommon = i <= 34;
        const wrongPattern = isCommon ? (i % 5 === 1) : (i % 3 === 0);
        results.push({
          question: i,
          isCorrect: !wrongPattern
        });
      }
      return results;
    }

    // 수학 결과 생성 (30문제)
    function generateMathResults() {
      const results = [];
      
      // 공통과목 (1-22번)
      for (let i = 1; i <= 22; i++) {
        let isCorrect = true;
        
        if (i <= 15) {
          // 객관식 (1-15번): 8번만 틀림
          isCorrect = i !== 8;
        } else {
          // 주관식 (16-22번): 19번만 틀림
          isCorrect = i !== 19;
        }
        
        results.push({
          question: i,
          isCorrect: isCorrect,
          type: i <= 15 ? '객관식' : '주관식',
          section: '공통과목'
        });
      }
      
      // 선택과목 (23-30번)
      for (let i = 23; i <= 30; i++) {
        let isCorrect = true;
        
        if (i <= 28) {
          // 객관식 (23-28번): 25번만 틀림
          isCorrect = i !== 25;
        } else {
          // 주관식 (29-30번): 29번만 틀림
          isCorrect = i !== 29;
        }
        
        results.push({
          question: i,
          isCorrect: isCorrect,
          type: i <= 28 ? '객관식' : '주관식',
          section: '선택과목'
        });
      }
      
      return results;
    }

    // 영어 결과 생성 (45문제)
    function generateEnglishResults() {
      const results = [];
      for (let i = 1; i <= 45; i++) {
        // 영어는 5문제씩 그룹으로 나누어 패턴 생성
        const wrongPattern = (i % 6 === 1) || (i % 8 === 0);
        results.push({
          question: i,
          isCorrect: !wrongPattern
        });
      }
      return results;
    }

    // 한국사 결과 생성 (20문제)
    function generateKoreanHistoryResults() {
      const results = [];
      for (let i = 1; i <= 20; i++) {
        const wrongPattern = (i % 4 === 1) || (i % 7 === 0);
        results.push({
          question: i,
          isCorrect: !wrongPattern
        });
      }
      return results;
    }

    // 과학탐구 결과 생성 (40문제 - 2과목)
    function generateScienceResults() {
      const results = [];
      for (let i = 1; i <= 40; i++) {
        // 첫 번째 과목(1-20)과 두 번째 과목(21-40)으로 구분
        const isFirstSubject = i <= 20;
        const wrongPattern = isFirstSubject ? (i % 5 === 2) : (i % 6 === 3);
        results.push({
          question: i,
          isCorrect: !wrongPattern
        });
      }
      return results;
    }

    // 사회탐구 결과 생성 (40문제 - 2과목)
    function generateSocialResults() {
      const results = [];
      for (let i = 1; i <= 40; i++) {
        // 첫 번째 과목(1-20)과 두 번째 과목(21-40)으로 구분
        const isFirstSubject = i <= 20;
        const wrongPattern = isFirstSubject ? (i % 4 === 3) : (i % 5 === 1);
        results.push({
          question: i,
          isCorrect: !wrongPattern
        });
      }
      return results;
    }

    // 기본 결과 생성 (20문제)
    function generateDefaultResults() {
      const results = [];
      for (let i = 1; i <= 20; i++) {
        const wrongPattern = (i % 4 === 1) || (i % 7 === 0);
        results.push({
          question: i,
          isCorrect: !wrongPattern
        });
      }
      return results;
    }

    // 수학용 구분된 레이아웃 생성
    function generateMathLayout(results) {
      const commonObjective = results.filter(r => r.section === '공통과목' && r.type === '객관식');
      const commonSubjective = results.filter(r => r.section === '공통과목' && r.type === '주관식');
      const electiveObjective = results.filter(r => r.section === '선택과목' && r.type === '객관식');
      const electiveSubjective = results.filter(r => r.section === '선택과목' && r.type === '주관식');

      return `
        <div class="space-y-6">
          <!-- 검색 기능 -->
          <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 mb-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">🔍 답안지 검색</h3>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">이름 검색</label>
                <input type="text" id="nameSearch" placeholder="학생 이름을 입력하세요" 
                       class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">학번 검색</label>
                <input type="text" id="studentIdSearch" placeholder="학번을 입력하세요" 
                       class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>
            </div>
            <div class="mt-3 flex gap-2">
              <button onclick="searchAnswers()" class="px-4 py-2 text-sm font-medium bg-blue-600 text-white rounded-lg hover:bg-blue-700">검색</button>
              <button onclick="clearSearch()" class="px-4 py-2 text-sm font-medium border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">초기화</button>
            </div>
          </div>

          <!-- 공통과목 -->
          <div class="space-y-4">
            <h4 class="text-xl font-bold text-blue-600 border-b-2 border-blue-200 pb-2">공통과목 (1-22번)</h4>
            
            <!-- 공통과목 객관식 -->
            <div class="space-y-3">
              <h5 class="text-base font-semibold text-white bg-blue-600 px-3 py-2 rounded-lg">객관식 (1-15번)</h5>
              <div class="grid grid-cols-8 gap-2">
                ${commonObjective.map(result => 
                  `<div class='rounded-lg px-3 py-2 text-center text-sm font-medium ${result.isCorrect ? 'bg-green-100 text-green-800 border border-green-300' : 'bg-red-100 text-red-800 border border-red-300'}'>${result.question}번</div>`
                ).join('')}
              </div>
            </div>
            
            <!-- 공통과목 주관식 -->
            <div class="space-y-3">
              <h5 class="text-base font-semibold text-white bg-blue-600 px-3 py-2 rounded-lg">주관식 (16-22번)</h5>
              <div class="grid grid-cols-8 gap-2">
                ${commonSubjective.map(result => 
                  `<div class='rounded-lg px-3 py-2 text-center text-sm font-medium ${result.isCorrect ? 'bg-green-100 text-green-800 border border-green-300' : 'bg-red-100 text-red-800 border border-red-300'}'>${result.question}번</div>`
                ).join('')}
              </div>
            </div>
          </div>

          <!-- 선택과목 -->
          <div class="space-y-4">
            <h4 class="text-xl font-bold text-purple-600 border-b-2 border-purple-200 pb-2">선택과목 (23-30번)</h4>
            
            <!-- 선택과목 객관식 -->
            <div class="space-y-3">
              <h5 class="text-base font-semibold text-white bg-purple-600 px-3 py-2 rounded-lg">객관식 (23-28번)</h5>
              <div class="grid grid-cols-8 gap-2">
                ${electiveObjective.map(result => 
                  `<div class='rounded-lg px-3 py-2 text-center text-sm font-medium ${result.isCorrect ? 'bg-green-100 text-green-800 border border-green-300' : 'bg-red-100 text-red-800 border border-red-300'}'>${result.question}번</div>`
                ).join('')}
              </div>
            </div>
            
            <!-- 선택과목 주관식 -->
            <div class="space-y-3">
              <h5 class="text-base font-semibold text-white bg-purple-600 px-3 py-2 rounded-lg">주관식 (29-30번)</h5>
              <div class="grid grid-cols-8 gap-2">
                ${electiveSubjective.map(result => 
                  `<div class='rounded-lg px-3 py-2 text-center text-sm font-medium ${result.isCorrect ? 'bg-green-100 text-green-800 border border-green-300' : 'bg-red-100 text-red-800 border border-red-300'}'>${result.question}번</div>`
                ).join('')}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // 문항별 결과 업데이트 (과목명 변환 포함)
    function updateQuestionResults(subjectText) {
      let subject = 'default';
      
      // 과목명을 영어 키로 변환
      if (subjectText.includes('국어')) {
        subject = '국어';
      } else if (subjectText.includes('수학')) {
        subject = '수학';
      } else if (subjectText.includes('영어')) {
        subject = '영어';
      } else if (subjectText.includes('한국사')) {
        subject = '한국사';
      } else if (subjectText.includes('과학탐구') || subjectText.includes('물리') || subjectText.includes('화학') || subjectText.includes('생명과학') || subjectText.includes('지구과학')) {
        subject = '과학탐구';
      } else if (subjectText.includes('사회탐구') || subjectText.includes('사회문화') || subjectText.includes('윤리') || subjectText.includes('지리') || subjectText.includes('경제') || subjectText.includes('사') || subjectText.includes('정치')) {
        subject = '사회탐구';
      }
      
      generateQuestionResults(subject);
    }

    // 과목별 채점 기록 필터링 (학생용)
    function filterRecords() {
      const filterValue = document.getElementById('subjectFilter').value;
      const tableBody = document.getElementById('recordsTableBody');
      const rows = tableBody.querySelectorAll('tr');
      const totalCountElement = document.getElementById('totalCount');
      
      let visibleCount = 0;
      
      rows.forEach(row => {
        const subject = row.getAttribute('data-subject');
        
        if (filterValue === 'all' || subject === filterValue) {
          row.style.display = '';
          visibleCount++;
        } else {
          row.style.display = 'none';
        }
      });
      
      // 총 건수 업데이트
      if (filterValue === 'all') {
        totalCountElement.textContent = `총 ${rows.length}건`;
      } else {
        totalCountElement.textContent = `${filterValue} ${visibleCount}건`;
      }
    }

    // 과목별 채점 기록 필터링 (교사용)
    function filterTeacherRecords() {
      const subjectFilter = document.getElementById('teacherSubjectFilter').value;
      const monthFilter = document.getElementById('teacherMonthFilter').value;
      const agencyFilter = document.getElementById('teacherAgencyFilter').value;
      const tableBody = document.getElementById('teacherRecordsTableBody');
      const rows = tableBody.querySelectorAll('tr');
      
      rows.forEach(row => {
        const subjectCell = row.querySelector('td:nth-child(5)');
        const monthCell = row.querySelector('td:nth-child(3)');
        const agencyCell = row.querySelector('td:nth-child(2)');
        
        if (subjectCell && monthCell && agencyCell) {
          const subjectSpan = subjectCell.querySelector('span');
          const subject = subjectSpan ? subjectSpan.textContent.trim() : '';
          const month = monthCell.textContent.trim();
          const agency = agencyCell.textContent.trim();
          
          const subjectMatch = subjectFilter === 'all' || subject === subjectFilter;
          const monthMatch = monthFilter === 'all' || month === monthFilter;
          const agencyMatch = agencyFilter === 'all' || agency === agencyFilter;
          
          if (subjectMatch && monthMatch && agencyMatch) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        }
      });
    }

    // 채점 결과 보기 함수 (모달)
    function viewResult(subject, subSubject, date, examName, score, wrongCount) {
      // 모달 열기
      openResultModal();
      
      // 모달 데이터 설정
      setModalData(subject, subSubject, date, examName, score, wrongCount);
      
      // 문항별 결과 생성
      updateModalQuestionResults(subject);
    }

    // 모달 열기
    function openResultModal() {
      const modal = document.getElementById('resultModal');
      modal.classList.add('open');
      modal.style.display = 'flex';
    }

    // 모달 닫기
    function closeResultModal() {
      const modal = document.getElementById('resultModal');
      modal.classList.remove('open');
      modal.style.display = 'none';
    }

    // 교사용 학생 목록 모달 열기
    function viewStudentList(subject, subSubject, date, examName) {
      openStudentListModal();
      setStudentListData(subject, subSubject, date, examName);
      generateStudentList(subject, subSubject, date, examName);
    }

    // 학생 목록 모달 열기
    function openStudentListModal() {
      const modal = document.getElementById('studentListModal');
      modal.classList.add('open');
      modal.style.display = 'flex';
    }

    // 학생 목록 모달 닫기
    function closeStudentListModal() {
      const modal = document.getElementById('studentListModal');
      modal.classList.remove('open');
      modal.style.display = 'none';
    }

    // 학생 목록 데이터 설정
    function setStudentListData(subject, subSubject, date, examName) {
      const title = document.getElementById('studentListTitle');
      const subtitle = document.getElementById('studentListSubtitle');
      title.textContent = `${examName} - ${subSubject}`;
      subtitle.textContent = `${date} 채점 결과`;
    }

    // 학생 목록 생성
    function generateStudentList(subject, subSubject, date, examName) {
      const tableBody = document.getElementById('studentListTableBody');
      
      // 샘플 학생 데이터 생성
      const students = generateSampleStudents(subject, subSubject, date, examName);
      
      tableBody.innerHTML = students.map(student => `
        <tr class="border-t hover:bg-gray-50">
          <td class="py-3 px-4 font-mono text-sm">${student.studentId}</td>
          <td class="py-3 px-4 font-medium">${student.name}</td>
          <td class="py-3 px-4 text-center">
            <div class="flex flex-col gap-1 items-center">
              <span class="px-2 py-1 text-xs rounded-full ${getSubjectColor(subject)}">${subject}</span>
              <span class="text-xs text-gray-600">${subSubject}</span>
            </div>
          </td>
          <td class="py-3 px-4 font-semibold text-green-600">${student.score}점</td>
          <td class="py-3 px-4">
            <span class="px-2 py-1 text-xs rounded-full ${getGradeColor(student.grade)}">${student.grade}등급</span>
          </td>
          <td class="py-3 px-4">
            <button class="px-3 py-1 text-xs rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50" 
                    onclick="viewResult('${subject}', '${subSubject}', '${date}', '${examName}', ${student.score}, ${student.wrongCount})">
              오답보기
            </button>
          </td>
        </tr>
      `).join('');
    }

    // 샘플 학생 데이터 생성
    function generateSampleStudents(subject, subSubject, date, examName) {
      const students = [];
      const names = ['홍길동', '김철수', '이영희', '박민수', '정수진', '최동현', '한지영', '윤태호', '강미영', '조성민'];
      
      for (let i = 0; i < 10; i++) {
        const score = Math.floor(Math.random() * 40) + 60; // 60-100점
        const grade = Math.ceil((100 - score) / 20) + 1; // 점수에 따른 등급
        const wrongCount = Math.floor(Math.random() * 10) + 1; // 1-10개 오답
        
        students.push({
          studentId: `2024${String(i + 1).padStart(3, '0')}`,
          name: names[i],
          score: score,
          grade: grade,
          wrongCount: wrongCount
        });
      }
      
      return students.sort((a, b) => b.score - a.score); // 점수순 정렬
    }

    // 과목별 색상 반환
    function getSubjectColor(subject) {
      const colors = {
        '수학': 'bg-blue-100 text-blue-800',
        '국어': 'bg-green-100 text-green-800',
        '영어': 'bg-purple-100 text-purple-800',
        '과학탐구': 'bg-orange-100 text-orange-800',
        '사회탐구': 'bg-orange-100 text-orange-800',
        '한국사': 'bg-gray-100 text-gray-800'
      };
      return colors[subject] || 'bg-gray-100 text-gray-800';
    }

    // 등급별 색상 반환
    function getGradeColor(grade) {
      const colors = {
        1: 'bg-green-100 text-green-800',
        2: 'bg-blue-100 text-blue-800',
        3: 'bg-yellow-100 text-yellow-800',
        4: 'bg-orange-100 text-orange-800',
        5: 'bg-red-100 text-red-800'
      };
      return colors[grade] || 'bg-gray-100 text-gray-800';
    }

    // 학생 검색
    function searchStudents() {
      const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
      const rows = document.querySelectorAll('#studentListTableBody tr');
      
      rows.forEach(row => {
        const studentId = row.querySelector('td:nth-child(1)').textContent.toLowerCase();
        const studentName = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
        
        if (studentId.includes(searchTerm) || studentName.includes(searchTerm)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    // 등급별 필터링
    function filterStudents() {
      const selectedGrade = document.getElementById('gradeFilter').value;
      const rows = document.querySelectorAll('#studentListTableBody tr');
      
      rows.forEach(row => {
        const gradeText = row.querySelector('td:nth-child(5)').textContent;
        const grade = gradeText.match(/(\d)등급/)?.[1];
        
        if (selectedGrade === 'all' || grade === selectedGrade) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    // 모달 데이터 설정 함수
    function setModalData(subject, subSubject, date, examName, score, wrongCount) {
      // 모달 제목 설정
      const modalTitle = document.getElementById('modalTitle');
      const modalSubtitle = document.getElementById('modalSubtitle');
      modalTitle.textContent = `${subSubject} 채점 결과`;
      modalSubtitle.textContent = `${examName} - ${date}`;
      
      // 총점 업데이트
      const modalTotalScore = document.getElementById('modalTotalScore');
      modalTotalScore.textContent = score;
      
      // 오답 개수 업데이트
      const modalWrongCount = document.getElementById('modalWrongCount');
      modalWrongCount.textContent = wrongCount;
      
      // 틀린 문항 업데이트
      const modalWrongQuestions = document.getElementById('modalWrongQuestions');
      const wrongQuestions = generateWrongQuestions(subject, wrongCount);
      modalWrongQuestions.textContent = wrongQuestions;
      
      // 유형 요약 업데이트
      const modalTypeSummary = document.getElementById('modalTypeSummary');
      const typeSummary = generateTypeSummary(subject, wrongCount);
      modalTypeSummary.textContent = typeSummary;
      
      // 문항별 결과 제목 업데이트
      const modalQuestionTitle = document.getElementById('modalQuestionTitle');
      modalQuestionTitle.textContent = `${subSubject} 문항별 결과`;
    }

    // 모달용 문항별 결과 생성
    function updateModalQuestionResults(subject) {
      const modalQuestionResults = document.getElementById('modalQuestionResults');
      const results = generateQuestionResultsData(subject);
      
      if (subject === '수학') {
        modalQuestionResults.innerHTML = generateMathLayout(results);
      } else {
        modalQuestionResults.innerHTML = generateDefaultLayout(results);
      }
    }

    // 문항별 결과 데이터 생성
    function generateQuestionResultsData(subject) {
      switch(subject) {
        case '국어': return generateKoreanResults();
        case '수학': return generateMathResults();
        case '영어': return generateEnglishResults();
        case '한국사': return generateKoreanHistoryResults();
        case '과학탐구': return generateScienceResults();
        case '사회탐구': return generateSocialResults();
        default: return generateDefaultResults();
      }
    }

    // 기본 레이아웃 생성
    function generateDefaultLayout(results) {
      return `
        <div class="space-y-4">
          <div class="grid grid-cols-8 gap-2">
            ${results.map(result => 
              `<div class='rounded-lg px-3 py-2 text-center text-sm font-medium ${result.isCorrect ? 'bg-green-100 text-green-800 border border-green-300' : 'bg-red-100 text-red-800 border border-red-300'}'>${result.question}번</div>`
            ).join('')}
          </div>
        </div>
      `;
    }

    // 결과 데이터 설정 함수
    function setResultData(subject, date, examName, score, wrongCount) {
      // 총점 업데이트
      const totalScoreElement = document.querySelector('.text-3xl.font-bold.text-blue-600');
      if (totalScoreElement) {
        totalScoreElement.textContent = score;
      }
      
      // 오답 개수 업데이트
      const wrongCountElement = document.querySelector('.text-3xl.font-bold.text-red-600');
      if (wrongCountElement) {
        wrongCountElement.textContent = wrongCount;
      }
      
      // 틀린 문항 업데이트 (예시)
      const wrongQuestionsElement = document.querySelector('.text-base.font-bold.text-red-600');
      if (wrongQuestionsElement) {
        // 실제로는 서버에서 받은 데이터를 사용해야 함
        const wrongQuestions = generateWrongQuestions(subject, wrongCount);
        wrongQuestionsElement.textContent = wrongQuestions;
      }
      
      // 유형 요약 업데이트
      const typeSummaryElement = document.querySelector('.text-xs.text-neutral-600');
      if (typeSummaryElement) {
        const typeSummary = generateTypeSummary(subject, wrongCount);
        typeSummaryElement.textContent = typeSummary;
      }
    }

    // 틀린 문항 생성 (예시)
    function generateWrongQuestions(subject, wrongCount) {
      const wrongQuestions = [];
      const totalQuestions = getTotalQuestions(subject);
      
      // 랜덤하게 틀린 문항 선택
      for (let i = 0; i < wrongCount; i++) {
        let questionNum;
        do {
          questionNum = Math.floor(Math.random() * totalQuestions) + 1;
        } while (wrongQuestions.includes(questionNum));
        wrongQuestions.push(questionNum);
      }
      
      return wrongQuestions.sort((a, b) => a - b).join('번, ') + '번';
    }

    // 과목별 총 문항 수 반환
    function getTotalQuestions(subject) {
      switch(subject) {
        case '국어': return 45;
        case '수학': return 30;
        case '영어': return 45;
        case '한국사': return 20;
        case '과학탐구': return 40;
        case '사회탐구': return 40;
        default: return 20;
      }
    }

    // 유형 요약 생성
    function generateTypeSummary(subject, wrongCount) {
      const typeSummaries = {
        '국어': '유형 요약: 문학(2), 비문학(3), 문법(1), 화법(1), 작문(1)',
        '수학': '유형 요약: 함수의 극한(2), 확률분포(2), 수열(1), 도형(1)',
        '영어': '유형 요약: 어휘(2), 문법(1), 독해(2)',
        '한국사': '유형 요약: 고대사(1), 근현대사(1)',
        '과학탐구': '유형 요약: 물리(3), 화학(4), 생명과학(3), 지구과학(2)',
        '사회탐구': '유형 요약: 사회문화(2), 윤리(2), 지리(3), 경제(2)'
      };
      
      return typeSummaries[subject] || '유형 요약: 기타';
    }

    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', function() {
      // 초기 총 건수 설정
      const tableBody = document.getElementById('recordsTableBody');
      if (tableBody) {
        const rows = tableBody.querySelectorAll('tr');
        const totalCountElement = document.getElementById('totalCount');
        if (totalCountElement) {
          totalCountElement.textContent = `총 ${rows.length}건`;
        }
      }

      // 모달 외부 클릭 시 닫기
      const resultModal = document.getElementById('resultModal');
      if (resultModal) {
        resultModal.addEventListener('click', function(e) {
          if (e.target === resultModal) {
            closeResultModal();
          }
        });
      }

      // 학생 목록 모달 외부 클릭 시 닫기
      const studentListModal = document.getElementById('studentListModal');
      if (studentListModal) {
        studentListModal.addEventListener('click', function(e) {
          if (e.target === studentListModal) {
            closeStudentListModal();
          }
        });
      }
    });
  </script>

  <!-- 교사용 학생 목록 모달 -->
  <div id="studentListModal" class="modal fixed inset-0 z-50 bg-black bg-opacity-50 items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden">
      <!-- 모달 헤더 -->
      <div class="relative p-6 border-b bg-gray-50">
        <button onclick="closeStudentListModal()" class="absolute top-4 right-4 p-2 hover:bg-gray-200 rounded-lg text-gray-600 hover:text-gray-800 font-bold text-xl">
          ×
        </button>
        <div class="text-center">
          <h3 class="text-xl font-semibold" id="studentListTitle">학생 목록</h3>
          <p class="text-sm text-gray-600" id="studentListSubtitle">시험별 학생 채점 결과</p>
        </div>
      </div>
      
      <!-- 모달 내용 -->
      <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
        <div class="space-y-4">
          <!-- 검색 및 필터 -->
          <div class="flex gap-4 mb-4">
            <input type="text" id="studentSearch" placeholder="학생명 또는 학번으로 검색..." 
                   class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   onkeyup="searchStudents()">
            <select id="gradeFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="filterStudents()">
              <option value="all">전체 등급</option>
              <option value="1">1등급</option>
              <option value="2">2등급</option>
              <option value="3">3등급</option>
              <option value="4">4등급</option>
              <option value="5">5등급</option>
            </select>
          </div>
          
          <!-- 학생 목록 테이블 -->
          <div class="rounded-lg border overflow-hidden">
            <table class="w-full text-left text-sm">
              <thead class="bg-gray-50">
                <tr class="text-neutral-500 border-b">
                  <th class="py-3 px-4">학번</th>
                  <th class="py-3 px-4">학생명</th>
                  <th class="py-3 px-4">채점과목</th>
                  <th class="py-3 px-4">점수</th>
                  <th class="py-3 px-4">등급</th>
                  <th class="py-3 px-4">오답보기</th>
                </tr>
              </thead>
              <tbody id="studentListTableBody">
                <!-- 학생 목록이 여기에 동적으로 생성됩니다 -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 오답보기 모달 -->
  <div id="resultModal" class="modal fixed inset-0 z-50 bg-black bg-opacity-50 items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden">
      <!-- 모달 헤더 -->
      <div class="relative p-6 border-b bg-gray-50">
        <button onclick="closeResultModal()" class="absolute top-4 right-4 p-2 hover:bg-gray-200 rounded-lg text-gray-600 hover:text-gray-800 font-bold text-xl">
          ×
        </button>
        <div class="text-center">
          <h3 class="text-xl font-semibold" id="modalTitle">채점 결과</h3>
          <p class="text-sm text-gray-600" id="modalSubtitle">문항별 정오표를 확인하세요</p>
        </div>
      </div>
      
      <!-- 모달 내용 -->
      <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
        <div class="grid gap-6 lg:grid-cols-4">
          <!-- 요약 정보 -->
          <div class="lg:col-span-1 rounded-2xl border bg-white">
            <div class="p-6 border-b">
              <h3 class="text-lg font-semibold">요약</h3>
            </div>
            <div class="p-6 space-y-4 text-sm">
              <div class="grid grid-cols-2 gap-4">
                <div class="rounded-xl bg-blue-50 p-4 border-2 border-blue-200">
                  <div class="text-3xl font-bold text-blue-600" id="modalTotalScore">0</div>
                  <div class="text-sm text-blue-700 font-medium">총점</div>
                </div>
                <div class="rounded-xl bg-red-50 p-4 border-2 border-red-200">
                  <div class="text-3xl font-bold text-red-600" id="modalWrongCount">0</div>
                  <div class="text-sm text-red-700 font-medium">오답</div>
                </div>
              </div>
              <div class="rounded-xl border-2 border-gray-200 p-4 bg-gray-50">
                <div class="text-sm text-gray-600 mb-2 font-medium">틀린 문항:</div>
                <div class="text-base font-bold text-red-600" id="modalWrongQuestions">-</div>
              </div>
              <div class="rounded-xl border p-3 text-xs text-neutral-600" id="modalTypeSummary">
                유형 요약: -
              </div>
            </div>
          </div>

          <!-- 문항별 결과 -->
          <div class="lg:col-span-3 rounded-2xl border bg-white">
            <div class="p-6 border-b">
              <h3 class="text-lg font-semibold" id="modalQuestionTitle">문항별 결과</h3>
            </div>
            <div class="p-6">
              <div id="modalQuestionResults" class="w-full">
                <!-- 문항별 결과가 여기에 동적으로 생성됩니다 -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>
