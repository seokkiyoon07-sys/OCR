# SNAR OCR 변경 이력

## 2025-01-20 (오늘)

### 주요 개선사항

#### 1. 채점 업로드 페이지 (`src/app/upload/page.tsx`)

##### 배점 입력 기능 개선
- **정수만 입력 가능**: 배점 입력 시 소수점 제거, 정수만 허용하도록 수정
- **5개 단위 연속 입력**: 
  - 수학 공통 객관식: 5개씩 연속 입력 (예: 22322)
  - 수학 선택 객관식: 6개씩 연속 입력 (예: 223322)
  - 국어/영어/탐구: 5개씩 연속 입력
  - 기타 과목: 문항 수에 따라 동적 조정
- **UI 개선**:
  - 고정폭 폰트(`font-mono`) 적용으로 가독성 향상
  - 최대 입력 길이 제한 (`maxLength`)
  - 입력 가이드 텍스트 추가
  - 자동 포커스 이동 유지

##### 성적표 정보 입력 기능
- **과목별 만점 자동 적용**:
  - 한국사, 사회탐구, 과학탐구: 50점 만점으로 표시
  - 국어, 수학, 영어: 100점 만점으로 표시
  - 생활과 윤리 등 모든 사회탐구 과목도 50점으로 적용
- **표준점수, 백분위, 등급 열 너비 통일**: 
  - `table-fixed` 클래스 적용
  - 각 열 `w-32` 고정 너비
- **입력 validation**:
  - 등급: 1-9 범위 제한
  - 백분위: 1-100 범위 제한
  - 응시자수: 단일 입력으로 변경
- **CSV 업로드 기능 추가**:
  - 표준점수, 백분위, 등급 정보를 CSV로 업로드 가능
  - CSV 파싱 후 자동으로 테이블에 데이터 반영
  - 파일 형식: `원점수,표준점수,백분위,등급,응시자수`
- **CSV 다운로드 기능 추가**:
  - 입력한 성적표 정보를 CSV로 다운로드
  - 파일명: `성적표정보_[과목명]_[날짜].csv`
  - Excel 호환을 위한 UTF-8 BOM 추가
- **모달 취소 버튼 추가**:
  - 정답 입력 모달 취소 버튼 유지
  - 성적표 정보 입력 모달에 취소 버튼 추가
  - 모든 모달에서 안전하게 닫을 수 있음

#### 2. 채점 결과 페이지 (`src/app/results/page.tsx`)

##### 과목별 제목 동적 표시
- **반별 점수 분석 제목**: 메인 과목명 또는 하위 과목명 자동 표시
  - 예: "국어 반별 점수 분석", "생활과 윤리 반별 점수 분석"
- **오답률 분석 제목**: 선택한 과목에 맞게 표시
  - 예: "국어 오답률 분석", "물리학I 오답률 분석"
- **하위 과목 지원**: 
  - 사회탐구: 생활과 윤리, 윤리와 사상, 한국지리 등 9개 과목
  - 과학탐구: 물리학I, 화학I, 생명과학I 등 8개 과목
  - 선택한 하위 과목명이 제목에 표시됨

##### 개별 결과 CSV 섹션
- **파일 형식 업데이트**: `수험번호,이름,소속반,과목코드,총점,만점,총문제수,정답수,오답번호`
- **과목별 채점 결과 위로 이동**: 더 상위 위치로 배치
- **문항별 오답률 CSV 다운로드**:
  - 선택한 과목의 전체 문항 오답률 CSV 다운로드
  - 전체 학생 및 상위권 학생 오답률 포함
  - 파일명: `문항별_오답률_[과목명]_[날짜].csv`

#### 3. 개인별 채점 결과 페이지 (`src/app/individual-results/page.tsx`)

##### 불필요한 정보 제거
- **"총 28명 채점 완료" 텍스트 제거**: 개인 리포트에 집단 정보는 불필요
- 개인 결과에 집중하도록 UI 단순화

### 기술적 세부사항

#### 수정된 파일 목록
1. `src/app/upload/page.tsx`
   - 배점 입력 핸들러 수정 (정수만 허용)
   - 성적표 정보 입력 모달 UI 개선
   - CSV 업로드/다운로드 기능 추가
   - 과목별 만점 자동 적용 로직 추가

2. `src/app/results/page.tsx`
   - 과목별 제목 동적 표시 함수 추가 (`getDisplaySubject`)
   - 하위 과목 선택 시 하위 과목명 표시

3. `src/app/individual-results/page.tsx`
   - "총 N명 채점 완료" 섹션 제거

#### 주요 함수 및 로직

##### `handleScoreInput` (배점 입력)
```typescript
// 정수만 허용하도록 수정
const integerValue = value.replace(/[^0-9]/g, '');
```

##### `getDisplaySubject` (과목명 표시)
```typescript
const getDisplaySubject = () => {
  if (subSubject) return subSubject;
  return mainSubject;
};
```

##### CSV 업로드 파싱
- FileReader API 사용
- 각 행을 쉼표로 분리하여 데이터 추출
- 유효한 원점수만 파싱하여 상태 업데이트

##### CSV 다운로드 생성
- 선택한 과목의 만점에 따라 데이터 행 생성
- UTF-8 BOM 추가로 Excel 호환성 확보
- 동적 파일명 생성

### 사용자 경험 개선
1. **배점 입력 직관성 향상**: 연속 입력으로 빠른 데이터 입력
2. **CSV 재사용**: 성적표 정보를 CSV로 저장/불러오기 가능
3. **명확한 과목 표시**: 하위 과목 선택 시 구체적인 과목명 표시
4. **개인 결과 포커스**: 개인별 페이지에서 집단 정보 제거

### 주요 버그 수정
- 사회탐구/과학탐구 하위 과목 선택 시 메인 과목명만 표시되던 문제 수정
- 생활과 윤리 등 일부 과목의 만점이 50점이 아닌 100점으로 표시되던 문제 수정
- 성적표 정보 입력 모달에 취소 버튼 없었던 문제 수정

---
_이 변경 이력은 2025-01-20 작업 내용을 정리한 것입니다._

